var color=function(t){return $.extend({r:0,g:0,b:0,a:1},t)};var multiplyColor=function(t){return function(n){return{r:Math.min(255,n.r*t),g:Math.min(255,n.g*t),b:Math.min(255,n.b*t),a:n.a}}};var desaturate=function(t){return function(n){var e=(n.r+n.g+n.b)/3;var r=1-t;return{r:r*n.r+t*e,g:r*n.g+t*e,b:r*n.b+t*e,a:n.a}}};var colorBrightness=function(t){return(t.r+t.g+t.b)/(255+255+255)};var colorString=function(t){return"rgba("+Math.floor(t.r)+","+Math.floor(t.g)+","+Math.floor(t.b)+","+t.a+")"};var rgbColorString=function(t){return"rgb("+Math.floor(t.r)+","+Math.floor(t.g)+","+Math.floor(t.b)+")"};var transparent=color({a:0});var black=color({r:0,g:0,b:0});var white=color({r:255,g:255,b:255});var Stream={create:function(){var t=false;var n=$.Deferred();var e;var r=[];var i=[];var o=function(i){n.resolve(i);if(!t&&e!==i){e=i;r.map(function(t){return t(i)})}};return{lastValue:function(){return e},map:function(t){var n=Stream.create();i.push(n);if(e!==undefined){n.push(t(e))}r.push(function(e){n.push(t(e))});return n},reduce:function(t,n){var o=Stream.once(n);i.push(o);if(e!==undefined){o.push(t(o.lastValue(),e))}r.push(function(n){o.push(t(o.lastValue(),n))});return o},filter:function(t){var n=Stream.create();i.push(n);if(e!==undefined){t(e,n.push)}r.push(function(e){t(e,n.push)});return n},onValue:function(t){return this.map(function(n){t(n);return true})},promise:n.promise(),prop:function(t){return this.map(function(n){return n[t]})},delay:function(t){var n=Stream.create();i.push(n);this.map(function(e){setTimeout(function(){n.push(e)},t)});return n},end:function(){i.map(function(t){t.end()});t=true},push:o,pushAll:function(t){this.onValue(function(n){t.push(n)})},test:function(){var t=arguments;var n=new Error;setTimeout(function(){if(e===undefined){t;n;debugger}},5e3);return this},cases:function(t,n){t.push(n);return Stream.combine(t,function(){var t=Array.prototype.slice.call(arguments);var n=t.pop();return t[n]})}}},once:function(t){var n=Stream.create();n.push(t);return n},never:function(){return Stream.create()},combine:function(t,n){var e=[];var r=Stream.create();var i=false;var o=new Error;var a=function(){if(!i){i=true;setTimeout(function(){o;i=false;for(var a=0;a<t.length;a++){if(e[a]===undefined){return}}r.push(n.apply(null,e))})}};t.reduce(function(t,n){n.onValue(function(n){e[t]=n;a()});return t+1},0);return r},all:function(t,n){return this.combine(t,function(){n.apply(null,arguments);return true})},combineObject:function(t){var n=Object.keys(t);var e={};var r=Stream.create();var i=false;var o=function(){if(!i){i=true;setTimeout(function(){i=false;for(var t=0;t<n.length;t++){var o=n[t];if(e[o]===undefined){return}}r.push($.extend({},e))})}};n.map(function(n,r){t[n].onValue(function(t){e[n]=t;o()})});return r},splitObject:function(t){var n=Object.keys(t);var e={};n.map(function(n){e[n]=Stream.once(t[n])});return e},fromPromise:function(t,n){var e=Stream.never();if(n){e.push(n)}t.then(function(t){e.push(t)});return e}};var child=function(t){if(!t||!t.create){console.error("faulty component")}return function(n){n.child(t)}};var children=function(t){t.map(function(t){if(!t||!t.create){console.error("faulty component")}});return function(n){n.children(t)}};var wireChildren=function(t){return function(n){n.wireChildren=t}};var component=function(t){var n={create:function(t){var n=this.build(t);n.wireChildren=n.wireChildren||function(){};var e=n.childComponentPs;var r=[];var i=e.map(function(t){if($.isArray(t)){var e=[];var i=t.map(function(t){var r=n.newCtx();e.push(r);return t.create(r)});r.push(e);return i}else{var o=n.newCtx();r.push(o);return t.create(o)}});n.childInstances=i;var o=n.wireChildren.apply(null,[n,t].concat(i))||[];var a=function(t,n,e){t=t||{};if(t.top){t.top.pushAll(e.top)}if(t.left){t.left.pushAll(e.left)}if(t.width){t.width.pushAll(e.width)}if(t.height){t.height.pushAll(e.height)}if(t.backgroundColor){t.backgroundColor.pushAll(e.backgroundColor)}if(t.fontColor){t.fontColor.pushAll(e.fontColor)}};for(var u=0;u<i.length;u++){var h=o[u]||{};var l=i[u];var c=r[u];if($.isArray(l)){for(var s=0;s<l.length;s++){a(h[s],l[s],c[s])}}else{a(h,l,c)}}return n},build:t,and:function(t){var n=this;var e=$.extend({},n);e.build=function(e){var r=n.build(e);var i=t(r,e);var o=r.destroy;if(i){r.destroy=function(){var t=i();if(t){t.then(function(){o.apply(r)})}else{o.apply(r)}}}return r};return e},all:function(t){return t.reduce(function(t,n){return t.and(n)},this)},compose:function(t){return t.reduce(function(t,n){return n(t)},this)}};return n};var liftC=function(t){return function(n){return n.and(t)}};var liftCF=function(t){return function(){var n=arguments;return function(e){return e.and(t.apply(null,n))}}};var findOptimalHeight=function(t,n){var e=$(".sandbox");var r=t.clone();r.css("height","").css("width",n).appendTo(e);var i=parseInt(r.css("height"));r.remove();return i};var findMinWidth=function(t){var n=$(".sandbox");var e=t.clone();e.css("width","").css("height","").appendTo(n);var r=parseInt(e.css("width"));e.remove();return r};var findScrollWidth=function(t,n){var e=$(".sandbox");var r=t.clone();r.css("width",n).css("height","").appendTo(e);var i=r[0].scrollWidth;r.remove();return i};var findMinHeight=function(t){var n=$(".sandbox");var e=t.clone();e.css("width","").css("height","").appendTo(n);var r=parseInt(e.css("height"));e.remove();return r};var updateDomFuncs=[];var applyFunc=function(t){t.$el.css(t.prop,t.value)};var runDomFuncs=function(){updateDomFuncs.map(applyFunc);updateDomFuncs=[];updateWindowWidth()};var updateDomFunc=function(t){if(updateDomFuncs.length===0){setTimeout(runDomFuncs)}updateDomFuncs.push(t)};var el=function(t){return component(function(n){var e=Stream.never();var r=Stream.never();var o=function(){var t=findMinHeight(i.$el);i.minWidth.push(mw);i.minHeight.push(t)};var a=$(document.createElement(t));if(a.prop("tagName").toLowerCase()==="div"){a.css("pointer-events","none")}else{a.css("pointer-events","initial")}a.css("position","absolute");a.css("visibility","hidden");n.$el.append(a);n.top.onValue(function(t){updateDomFunc({$el:a,prop:"top",value:px(t)})});n.left.onValue(function(t){updateDomFunc({$el:a,prop:"left",value:px(t)})});n.width.onValue(function(t){updateDomFunc({$el:a,prop:"width",value:px(t)})});n.height.onValue(function(t){updateDomFunc({$el:a,prop:"height",value:px(t)})});Stream.combine([n.width,n.height,n.top,n.left],function(){updateDomFunc({$el:a,prop:"visibility",value:""})});n.backgroundColor.onValue(function(t){a.css("background-color",colorString(t))});n.fontColor.onValue(function(t){a.css("color",colorString(t))});var u=[];var h=Stream.combine([n.scroll,n.top],function(t,n){return t-n});var l=Stream.combine([n.topAccum,n.top],function(t,n){return t+n});var c=Stream.combine([n.leftAccum,n.left],function(t,n){return t+n});var s=Stream.combine([n.brightness,n.backgroundColor],function(t,n){var e=colorBrightness(n);return n.a*e+(1-n.a)*t});var m=function(t){return{$el:a,scroll:h,topAccum:l,top:Stream.never(),left:Stream.never(),leftAccum:c,width:Stream.never(),height:Stream.never(),backgroundColor:Stream.once(transparent),fontColor:Stream.never(),brightness:s}};return{$el:a,optimalWidth:0,minWidth:e,minHeight:r,newCtx:m,childComponentPs:u,child:function(t){u.push(t)},children:function(t){u.push(t)},destroy:function(){e.end();r.end();var t=this.childInstances||[];for(var n=0;n<t.length;n++){var i=t[n];if($.isArray(i)){var o=i;o.map(function(t){t.destroy()})}else{i.destroy()}}this.$el.remove()},updateDimensions:function(t){var n=findMinWidth(this.$el);var e=findMinHeight(this.$el);if(this.$el.prop("tagName")!=="IMG"){if(!t||n!==0){this.minWidth.push(n)}if(!t||e!==0){this.minHeight.push(e)}}}}})};var a=el("a");var button=el("button");var div=el("div");var form=el("form");var iframe=el("iframe");var img=el("img");var input=el("input");var li=el("li");var option=el("option");var select=el("select");var textarea=el("textarea");var ul=el("ul");var rootContext=function(){return{$el:$("body"),top:Stream.once(0),topAccum:Stream.once(0),left:Stream.once(0),leftAccum:Stream.once(0),scroll:windowScroll,width:windowWidth,height:Stream.never(),backgroundColor:Stream.once(white),fontColor:Stream.once(black),brightness:Stream.once(1)}};var rootComponent=function(t,n,e){var r=$.extend(rootContext(),n);var i=t.create(r);i.minHeight.pushAll(r.height);if(e){r.width.map(function(t){r.$el.css("width",t)});r.height.map(function(t){r.$el.css("height",t)})}return i};var add=function(t,n){return t+n};var mathMax=function(t,n){return Math.max(t,n)};var mathMin=function(t,n){return Math.min(t,n)};var passThroughToFirst=function(t,n,e){e.minHeight.pushAll(t.minHeight);e.minWidth.pushAll(t.minWidth);return[{width:n.width,height:n.height,top:Stream.once(0),left:Stream.once(0)}]};var unit=function(t){return function(n){return n+t}};var px=unit("px");var url=function(t){return'url("'+t+'")'};var debugPrintHeight=function(t){t.minHeight.map(function(t){console.log(t);console.log((new Error).stack)})};var debugPrintWidth=function(t){t.minWidth.map(function(t){console.log(t);console.log((new Error).stack)})};var $$=function(t){return function(){var n=Array.prototype.slice.call(arguments);return function(e){e.$el[t].apply(e.$el,n);setTimeout(function(){e.updateDimensions(true)})}}};var $addClass=$$("addClass");var $css=$$("css");var $attr=$$("attr");var $prop=$$("prop");var $cssC=liftCF($css);var chooseHeightFromWidth=function(t,n){var e=false;n.width.onValue(function(n){if(!e){e=true;setTimeout(function(){var r=findOptimalHeight(t.$el,n);t.minHeight.push(r);e=false})}})};var $html=function(t,n){return function(e,r){e.$el.html(t);chooseHeightFromWidth(e,r);if(n){e.updateDimensions()}}};var windowWidth=Stream.never();var windowHeight=Stream.never();var updateWindowWidth=function(){windowWidth.push(document.documentElement.clientWidth)};var updateWindowHeight=function(){windowHeight.push(window.innerHeight)};$(updateWindowWidth);$(updateWindowHeight);$(window).on("resize",function(){updateWindowWidth();updateWindowHeight()});var windowResize=Stream.once(null);$(window).on("resize",function(t){windowResize.push(t)});var windowScroll=Stream.never();$(window).on("scroll",function(){windowScroll.push(window.scrollY)});windowScroll.push(window.scrollY);var windowHash=Stream.never();$(window).on("hashchange",function(){windowHash.push(location.hash)});windowHash.push(location.hash);var withMinWidth=function(t,n){return function(e){e.minWidth.push(t);if(n){e.minWidth.end()}}};var withMinHeight=function(t,n){return function(e){e.minHeight.push(t);if(n){e.minHeight.end()}}};var adjustMinSize=function(t){return function(n){return div.all([child(n),wireChildren(function(n,e,r){r.minWidth.map(function(n){return t.mw(n)}).pushAll(n.minWidth);r.minHeight.map(function(n){return t.mh(n)}).pushAll(n.minHeight);return[{top:Stream.once(0),left:Stream.once(0),width:e.width,height:e.height}]})])}};var link=function(t){t.$el.css("cursor","pointer").css("pointer-events","all")};var componentName=function(t){return function(n){n.$el.addClass(t)}};var onThis=function(t){return function(n){return function(e){var r=false;e.$el.on(t,function(t){if(!r){return n(t,function(){r=true;return function(){r=false}},e)}})}}};var changeThis=onThis("change");var clickThis=onThis("click");var inputPropertychangeThis=onThis("input propertychange");var keydownThis=onThis("keydown");var keyupThis=onThis("keyup");var mousedownThis=onThis("mousedown");var mousemoveThis=onThis("mousemove");var mouseoverThis=onThis("mouseover");var mouseoutThis=onThis("mouseout");var mouseupThis=onThis("mouseup");var submitThis=onThis("submit");var hoverThis=function(t){return function(n){t(false,n);n.$el.on("mouseover",function(){t(true,n)});n.$el.on("mouseout",function(){t(false,n)})}};var hoverStream=function(t,n){n=n||function(t){return t};return function(e){e.$el.on("mouseover",function(e){t.push(n(e));e.stopPropagation()});$("body").on("mouseover",function(e){t.push(n(false))})}};var cssStream=function(t,n){return function(e){n.map(function(n){e.$el.css(t,n)})}};var withBackgroundColor=function(t,n){if(!t.map){t=Stream.once({backgroundColor:t,fontColor:n})}return function(n,e){t.map(function(t){var n=t.backgroundColor;var r=t.fontColor;e.backgroundColor.push(n);setTimeout(function(){setTimeout(function(){var t=n.a*colorBrightness(n)+(1-n.a)*e.brightness.lastValue();e.fontColor.push(r||(t>.5?black:white))})})})}};var withFontColor=function(t){return function(n,e){e.fontColor.push(t)}};var hoverColor=function(t,n,e,r){t=colorString(t||transparent);n=colorString(n||t);e=colorString(e||black);r=colorString(r||e);return hoverThis(function(i,o){o.$el.css("background-color",i?n:t);o.$el.css("color",i?r:e)})};var keepAspectRatioCorner=function(t){t=t||{};return function(n){return div.all([$css("overflow","hidden"),child(n),wireChildren(function(n,e,r){r.minWidth.pushAll(n.minWidth);r.minHeight.pushAll(n.minHeight);var i={top:Stream.create(),left:Stream.create(),width:Stream.create(),height:Stream.create()};Stream.combine([r.minWidth,r.minHeight,e.width,e.height],function(n,e,r,o){var a=n/e;var u=r/o;if(!t.fillSpace&&u>a||t.fillSpace&&u<a){var h=o*a;var l;if(t.left){l=0}else if(t.right){l=r-h}else{l=(r-h)/2}i.top.push(0);i.left.push(l);i.width.push(h);i.height.push(o)}else{var c=r/a;var s;if(t.top){s=0}else if(t.bottom){s=o-c}else{s=(o-c)/2}i.top.push(s);i.left.push(0);i.width.push(r);i.height.push(c)}});return[i]})])}};var keepAspectRatio=keepAspectRatioCorner();var keepAspectRatioFill=keepAspectRatioCorner({fillSpace:true});var image=function(t){var n=t.src&&t.src.map?t.src:Stream.once(t.src);return img.all([$css("pointer-events","all"),function(e,r){n.map(function(t){e.$el.prop("src",t)});e.$el.css("display","none");e.$el.on("load",function(){e.$el.css("display","");var n=e.$el[0].naturalWidth;var i=e.$el[0].naturalHeight;var o=n/i;var a=t.minWidth||t.chooseWidth||n;var u=t.minHeight||t.chooseHeight||a/o;e.minWidth.push(a);e.minHeight.push(u);var h,l;if(t.minWidth!==undefined&&t.minWidth!==null){h=t.minWidth;l=h/o;e.minWidth.push(h);e.minHeight.push(l)}else if(t.minHeight!==undefined&&t.minHeight!==null){l=t.minHeight;h=l*o;e.minWidth.push(h);e.minHeight.push(l)}else if(t.useNativeWidth){e.minWidth.push(n);e.minHeight.push(i)}else{e.minWidth.push(n)}if(!t.useNativeWidth){r.width.map(function(t){return t/o}).pushAll(e.minHeight)}})}])};var linkTo=function(t,n){return a.all([$prop("href",t),child(n),wireChildren(passThroughToFirst)])};var nothing=div.all([componentName("nothing"),withMinHeight(0),withMinWidth(0)]);var text=function(t){if(!(t.map&&t.push)){t=Stream.once(t)}return div.all([componentName("text"),$css("pointer-events","all"),function(n,e){chooseHeightFromWidth(n,e);t.onValue(function(t){if(t){while(t.indexOf(" ")!==-1){t=t.replace(" ","&nbsp;")}}n.$el.html(t);n.minWidth.push(findMinWidth(n.$el))})}])};var faIcon=function(t){return text('<i class="fa fa-'+t+'"></i>')};var paragraph=function(t,n){if(!(t.map&&t.push)){t=Stream.once(t)}n=n||0;return div.all([componentName("paragraph"),$css("pointer-events","all"),function(e,r){chooseHeightFromWidth(e,r);e.updateDimensions=function(){e.minWidth.push(findScrollWidth(e.$el,n))};t.onValue(function(t){e.$el.html(t);e.updateDimensions()});Stream.combine([t,r.width],function(t,n){var r=findOptimalHeight(e.$el,n);e.minHeight.push(r)})}])};var ignoreSurplusWidth=function(t,n){return n};var ignoreSurplusHeight=function(t,n){return n};var centerSurplusWidth=function(t,n){var e=n[n.length-1];var r=t-(e.left+e.width);var i=r/n.length;n.map(function(t,n){t.left+=r/2});return n};var evenSplitSurplusWidth=function(t,n){var e=n[n.length-1];var r=t-(e.left+e.width);var i=r/n.length;n.map(function(t,n){t.width+=i;t.left+=n*i});return n};var justifySurplusWidth=function(t,n){var e=n[n.length-1];var r=t-(e.left+e.width);n.map(function(t,e){for(var i=0;i<e;i++){t.left+=r/(n.length-1)}});return n};var justifyAndCenterSurplusWidth=function(t,n){var e=n[n.length-1];var r=t-(e.left+e.width);n.map(function(t,e){t.left+=e*r/n.length+r/(2*n.length)});return n};var surplusWidthAlign=function(t){return function(n,e){var r=e[e.length-1];var i=n-(r.left+r.width);e.map(function(n,e){n.left+=t*i});return e}};var surplusWidthAlignLeft=surplusWidthAlign(0);var surplusWidthAlignCenter=surplusWidthAlign(.5);var surplusWidthAlignRight=surplusWidthAlign(1);var superSurplusWidth=function(t,n){var e=n[n.length-1];var r=t-(e.left+e.width);if(n.length===1){if(r<n[0].width){return evenSplitSurplusWidth(t,n)}else{return n}}if(n.length===2){return justifyAndCenterSurplusWidth(t,n)}return justifySurplusWidth(t,n)};var giveToNth=function(t){return function(n,e){var r=e[e.length-1];var i=n-(r.left+r.width);e.map(function(n,r){if(r===t||r===e.length-1&&t>=e.length){n.width+=i}else if(r>t){n.left+=i}});return e}};var giveToFirst=giveToNth(0);var giveToSecond=giveToNth(1);var giveToThird=giveToNth(2);var giveHeightToNth=function(t){return function(n,e){var r=e[e.length-1];var i=n-(r.top+r.height);e.map(function(n,r){if(r===t||r===e.length-1&&t>=e.length){n.height+=i}else if(r>t){n.top+=i}});return e}};var slideshow=function(t,n){t.gutterSize=t.gutterSize||0;t.leftTransition=t.leftTransition||"none";t.alwaysFullWidth=t.alwaysFullWidth||false;return div.all([$css("overflow","hidden"),componentName("slideshow"),children(n.map(function(n){return n.all([$css("transition","left "+t.leftTransition)])})),wireChildren(function(n,e,r){var i=Stream.combine(r.map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);return t});i.onValue(function(e){n.minWidth.push(e.reduce(add,t.gutterSize*(r.length-1)))});var o=r.map(function(){return{top:Stream.once(0),left:Stream.never(),width:Stream.never(),height:e.height}});Stream.all([t.selected,e.width,i],function(n,e,r){var i=0;var a=0;var u=0;var h=r.map(function(r,o){r=t.alwaysFullWidth?e:r;if(n===o){i=u+t.gutterSize*o;a=r}var h={left:u+t.gutterSize*o,width:r};u+=r;return h});var l=(e-a)/2-i;h.map(function(t){t.left+=l});h.map(function(t,n){var e=o[n];e.left.push(t.left);e.width.push(t.width)})});Stream.combine(r.map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);var n=t.reduce(mathMax,0);o.map(function(t){t.height.push(n)});return n}).pushAll(n.minHeight);return[o]})])};var slideshowVertical=function(t,n){t.gutterSize=t.gutterSize||0;t.topTransition=t.topTransition||"none";t.alwaysFullHeight=t.alwaysFullHeight||false;return div.all([$css("overflow","hidden"),componentName("slideshow"),children(n.map(function(n){return n.all([$css("transition","top "+t.topTransition)])})),wireChildren(function(n,e,r){var i=Stream.combine(r.map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);return t});i.onValue(function(t){n.minHeight.push(t.reduce(mathMax,0))});var o=r.map(function(t){return{top:Stream.never(),left:Stream.once(0),width:e.width,height:t.minHeight}});Stream.all([t.selected,e.height,i],function(n,e,r){var i=0;var a=0;var u=0;var h=r.map(function(r,o){r=t.alwaysFullHeight?e:r;if(n===o){i=u+t.gutterSize*o;a=r}var h={top:u+t.gutterSize*o,height:r};u+=r;return h});var l=(e-a)/2-i;h.map(function(t){t.top+=l});h.map(function(t,n){var e=o[n];e.top.push(t.top);e.height.push(t.height)})});Stream.combine(r.map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);var n=t.reduce(mathMax,0);return n}).pushAll(n.minWidth);return[o]})])};var sideBySide=function(t,n){t.gutterSize=t.gutterSize||0;t.handleSurplusWidth=t.handleSurplusWidth||ignoreSurplusWidth;return div.all([componentName("sideBySide"),children(n),wireChildren(function(n,e,r){var i=Stream.combine(r.map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);return t});i.onValue(function(e){n.minWidth.push(e.reduce(add,t.gutterSize*(r.length-1)))});var o=r.map(function(){return{top:Stream.once(0),left:Stream.never(),width:Stream.never(),height:e.height}});Stream.all([e.width,i],function(n,e){var r=0;var i=e.map(function(n,e){var i={left:r+t.gutterSize*e,width:n};r+=n;return i});i=t.handleSurplusWidth(n,i);i.map(function(t,n){var e=o[n];e.left.push(t.left);e.width.push(t.width)})});Stream.combine(r.map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);return t.reduce(mathMax,0)}).pushAll(n.minHeight);return[o]})])};var slider=function(t,n){t=t||{};t.leftTransition=t.leftTransition||"0s";var e=Stream.once(false);var r={left:"left",right:"right"};var i=Stream.once({index:0,edge:"left"});var o=0;return div.all([componentName("slider"),$css("overflow-x","hidden"),$css("cursor","grab; -webkit-grab; -moz-grab;"),children(n),wireChildren(function(n,r,a){var u=Stream.combine(a.map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);return t});var h=u.map(function(t){return t.reduce(add,0)});u.onValue(function(t){n.minWidth.push(t.reduce(mathMax,0))});Stream.combine(a.map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);return t.reduce(mathMax,0)}).pushAll(n.minHeight);var l=Stream.combine([r.width,u,i,e],function(t,n,e,r){var i=e.edge==="left"?0:t;n.map(function(t,n){if(n<e.index){i-=t}if(e.edge==="right"&&n===e.index){i-=t}});if(r!==false){i+=r}return i});var c=Stream.combine([u,l],function(t,n){return t.reduce(function(t,n){t.arr.push(t.lastValue);t.lastValue+=n;return t},{arr:[],lastValue:n}).arr});n.$el.css("user-select","none");n.$el.on("mousedown",function(t){t.preventDefault();e.push(0);a.map(function(t){t.$el.css("transition","left 0s")})});var s=function(n){a.map(function(n){n.$el.css("transition","left "+t.leftTransition)});var o=u.lastValue();var h=r.width.lastValue();var c=e.lastValue();if(!c){return}var s=l.lastValue();var m=o.reduce(function(t,n){var e=t[t.length-1];t.push(e-n);return t},[0]);var f=m.reduce(function(t,n,e){var r=Math.abs(n-s);var i=Math.abs(n-(s-h));return{left:r<t.left.distance?{distance:r,index:e}:t.left,right:i<t.right.distance?{distance:i,index:e-1}:t.right}},{left:{distance:Number.MAX_VALUE,index:-1},right:{distance:Number.MAX_VALUE,index:-1}});if(f.left.distance<=f.right.distance){i.push({index:f.left.index,edge:"left"})}else{i.push({index:f.right.index,edge:"right"})}e.push(false);n.preventDefault()};n.$el.on("mouseup",s);n.$el.on("mouseout",s);n.$el.on("mousemove",function(t){var n=e.lastValue();var i=h.lastValue();var a=r.width.lastValue();var u=l.lastValue();if(n!==false){var c=t.clientX-o;var s=u+c;s=Math.min(0,s);if(i>a){s=Math.max(a-i,s)}c=s-u;n=n+c;e.push(n)}o=t.clientX});return[a.map(function(t,n){return{top:Stream.once(0),left:c.map(function(t){return t[n]}),width:t.minWidth,height:r.height}})]})]).all([])};var stack2=function(t,n){t.gutterSize=t.gutterSize||0;t.handleSurplusHeight=t.handleSurplusHeight||ignoreSurplusHeight;return div.all([componentName("stack2"),children(n),wireChildren(function(n,e,r){var i=Stream.combine(r.map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);return t});i.onValue(function(e){n.minHeight.push(e.reduce(add,t.gutterSize*(r.length-1)))});var o=r.map(function(){return{top:Stream.create(),left:Stream.once(0),width:e.width,height:Stream.never()}});Stream.all([e.height,i],function(n,e){var r=0;var i=e.map(function(n,e){var i={top:r+t.gutterSize*e,height:n};r+=n;return i});i=t.handleSurplusHeight(n,i);i.map(function(t,n){var e=o[n];e.top.push(t.top);e.height.push(t.height)})});Stream.combine(r.map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);return t.reduce(mathMax,0)}).pushAll(n.minWidth);return[o]})])};var intersperse=function(t,n){var e=[];t.map(function(t){e.push(t);e.push(n)});e.pop();return e};var stackTwo=function(t,n){t.gutterSize=t.gutterSize||0;t.align=t.align||"left";return div.all([componentName("stack"),children(n),wireChildren(function(n,e,r){var i=r[0];var o=r[1];var a=t.gutterSize;var u=[];n.minHeight.push(0);n.minWidth.push(0);Stream.combine([i.minHeight,o.minHeight],function(t,n){return t+n+a}).pushAll(n.minHeight);Stream.combine([i.minWidth,o.minWidth],function(t,n){return Math.max(t,n)}).pushAll(n.minWidth);return[[{top:Stream.once(0),left:Stream.once(0),width:e.width,height:i.minHeight},{top:i.minHeight.map(function(t){return t+a}),left:Stream.once(0),width:e.width,height:o.minHeight}]]})])};var stack=function(t,n){t.gutterSize=t.gutterSize||0;t.collapseGutters=t.collapseGutters||false;t.align=t.align||"left";if(n.length===0){n=[nothing]}return div.all([componentName("stack"),children(n),wireChildren(function(n,e,r){var i=t&&t.gutterSize||0;var o=function(n){if(n.length===0){return Stream.once(0)}return Stream.combine(n.map(function(n,r){var i;if(t&&t.mhs&&t.mhs[r]){var o=t.mhs[r](e);return Stream.combine([n.minHeight,o],mathMax)}else{return n.minHeight}return n.minHeight}),function(){var n=Array.prototype.slice.call(arguments);var e=n.reduce(function(n,e){return n+e+(t.collapseGutters&&e===0?0:i)},-i);return e})};var a=[];r.reduce(function(n,r,u){var h=o(n).map(function(n){return n+(u===0||t.collapseGutters&&n===0?0:i)});var l;if(t&&t.mhs&&t.mhs[n.length]){var c=t.mhs[n.length](e);l=Stream.combine([r.minHeight,c],mahtMax)}else{l=r.minHeight}a.push({top:h,left:Stream.once(0),width:e.width,height:l});n.push(r);return n},[]);o(r).pushAll(n.minHeight);Stream.combine(r.map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);return t.reduce(mathMax,0)}).pushAll(n.minWidth);return[a]})])};var adjustPosition=function(t,n){var e=t.top||0;var r=t.left||0;var i=t.expand;return div.all([componentName("adjustPosition"),child(n),wireChildren(function(t,n,o){o.minWidth.map(function(t){return t+i?r:0}).pushAll(t.minWidth);o.minHeight.map(function(t){return t+i?e:0}).pushAll(t.minHeight);return[{top:n.top.map(function(t){return t+e}),left:n.left.map(function(t){return t+r}),width:n.width,height:n.height}]})])};var padding=function(t,n){var e=t.all||0,r=t.all||0,i=t.all||0,o=t.all||0;if($.isNumeric(t)){e=r=i=o=t}else{for(var a in t){var u=a.toLowerCase();if(t[a]!==null){if(u.indexOf("top")!==-1){e=t[a]}if(u.indexOf("bottom")!==-1){r=t[a]}if(u.indexOf("left")!==-1){i=t[a]}if(u.indexOf("right")!==-1){o=t[a]}}}}return div.all([componentName("padding"),child(n),wireChildren(function(t,n,a){a.minWidth.map(function(t){return t+i+o}).pushAll(t.minWidth);a.minHeight.map(function(t){return t+e+r}).pushAll(t.minHeight);return[{top:Stream.once(e,"padding top"),left:Stream.once(i,"padding left"),width:n.width.map(function(t){return t-i-o}),height:n.height.map(function(t){return t-e-r})}]})])};var margin=function(t){return function(n){return padding(t,n)}};var alignLRM=function(t){return div.all([componentName("alignLRM"),child(t.middle||nothing),child(t.left||nothing),child(t.right||nothing),wireChildren(function(t,n,e,r,i){var o=Stream.combine([e,r,i].map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);var n=t.reduce(function(t,n){return Math.max(t,n)},0);return n});o.pushAll(t.minHeight);Stream.combine([e,r,i].map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);var n=t.reduce(function(t,n){return t+n},0);return n}).pushAll(t.minWidth);var a=function(t,n){return Stream.combine([t,n],mathMin)};var u=a(n.width,e.minWidth);var h=a(n.width,r.minWidth);var l=a(n.width,i.minWidth);return[{top:Stream.once(0),left:Stream.combine([n.width,u],function(t,n){return(t-n)/2}),width:u,height:n.height},{top:Stream.once(0),left:Stream.once(0),width:h,height:n.height},{top:Stream.once(0),left:Stream.combine([n.width,l],function(t,n){return t-n}),width:l,height:n.height}]})])};var alignTBM=function(t){t.middle=t.middle||nothing;t.bottom=t.bottom||nothing;t.top=t.top||nothing;return div.all([componentName("alignTBM"),child(t.middle),child(t.bottom),child(t.top),wireChildren(function(t,n,e,r,i){var o=Stream.combine([e,r,i].map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);var n=t.reduce(function(t,n){return Math.max(t,n)},0);return n});o.pushAll(t.minWidth);Stream.combine([e,r,i].map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);var n=t.reduce(function(t,n){return t+n},0);return n}).pushAll(t.minHeight);return[{top:Stream.combine([n.height,e.minHeight],function(t,n){return(t-n)/2}),left:Stream.once(0),width:n.width,height:e.minHeight},{top:Stream.combine([n.height,r.minHeight],function(t,n){return t-n}),left:Stream.once(0),width:n.width,height:r.minHeight},{top:Stream.once(0),left:Stream.once(0),width:n.width,height:i.minHeight}]})])};var invertOnHover=function(t){var n=Stream.once(false,"invert");var e=function(t,e){return Stream.combine([n,t,e],function(t,n,e){return t?e:n},"choose stream")};return div.all([componentName("invert-on-hover"),child(t.and($css("transition","background-color 0.2s linear, color 0.1s linear"))),wireChildren(function(t,n,r){r.minHeight.pushAll(t.minHeight);r.minWidth.pushAll(t.minWidth);return[{backgroundColor:e(n.backgroundColor,n.fontColor),fontColor:e(n.fontColor,n.backgroundColor),top:Stream.once(0),left:Stream.once(0),width:n.width,height:n.height}]}),mouseoverThis(function(){n.push(true)}),mouseoutThis(function(){n.push(false)})])};var border=function(t,n,e){var r=n.left||n.all||0;var i=n.right||n.all||0;var o=n.top||n.all||0;var a=n.bottom||n.all||0;var u=n.radius||0;if(!t.onValue){t=Stream.once(t)}var h=t.map(colorString);return div.all([componentName("border"),child(div.all([componentName("border-child"),$css("border-radius",px(u)),child(e),wireChildren(passThroughToFirst)])),function(t){h.map(function(n){t.$el.css("border-left",px(r)+" solid "+n);t.$el.css("border-right",px(i)+" solid "+n);t.$el.css("border-top",px(o)+" solid "+n);t.$el.css("border-bottom",px(a)+" solid "+n)})},wireChildren(function(t,n,e){e.minWidth.map(function(t){return t+r+i}).pushAll(t.minWidth);e.minHeight.map(function(t){return t+o+a}).pushAll(t.minHeight);return[{top:Stream.once(0),left:Stream.once(0),width:n.width.map(function(t){return t-r-i}),height:n.height.map(function(t){return t-o-a})}]})])};var componentStream=function(t){var n;return div.all([componentName("component-stream"),function(e,r){var i=e.newCtx();i.top.push(0);i.left.push(0);r.width.pushAll(i.width);r.height.pushAll(i.height);var o=Stream.create();t.pushAll(o);o.map(function(t){var r=function(t){if(n){n.destroy()}n=t.create(i);n.$el.css("transition","inherit");n.minWidth.pushAll(e.minWidth);n.minHeight.pushAll(e.minHeight)};if(t.then){t.then(function(t){r(t)},function(t){console.error("child components failed to load");console.log(t)})}else{r(t)}});return function(){o.end();if(n){n.destroy()}}}])};var promiseComponent=function(t){var n=Stream.once(nothing);t.then(function(t){n.push(t)},function(t){console.log(t)});return componentStream(n)};var toggleComponent=function(t,n){return componentStream(n.map(function(n){return t[n]}))};var modalDialog=function(t){return function(n,e){var r=Stream.once(false);n.pushAll(r);e=e||0;return div.all([$css("z-index",100),componentName("toggle-height"),child(t),wireChildren(function(t,n,i){t.minWidth.push(0);t.minHeight.push(0);var o=i.$el;o.css("position","fixed");o.css("transition",o.css("transition")+", opacity "+e+"s");o.css("display","none");r.onValue(function(t){if(t){o.css("display","");setTimeout(function(){o.css("opacity",1)},100)}else{o.css("opacity",0);setTimeout(function(){o.css("display","none")},e*1e3)}});return[{width:Stream.combine([windowWidth,i.minWidth],function(t,n){return Math.min(t,n)}),height:Stream.combine([windowHeight,i.minHeight],function(t,n){return Math.min(t,n)}),left:Stream.combine([windowWidth,i.minWidth],function(t,n){return Math.max(0,(t-n)/2)}),top:Stream.combine([windowHeight,i.minHeight],function(t,n){return Math.max(0,(t-n)/2)})}]})])}};var toggleHeight=function(t){var n=Stream.once(false);t.pushAll(n);return function(t){return div.all([$css("overflow","hidden"),componentName("toggle-height"),child(t),wireChildren(function(t,e,r){
r.minWidth.pushAll(t.minWidth);Stream.combine([r.minHeight,n],function(t,n){return n?t:0}).pushAll(t.minHeight);return[{top:Stream.once(0),left:Stream.once(0),width:e.width,height:e.height}]})])}};var dropdownPanel=function(t,n,e,r){r=r||{};r.transition=r.transition||"0.5s";return div.all([componentName("dropdown-panel"),child(div.all([child(n),wireChildren(function(t,n,i){i.minWidth.pushAll(t.minWidth);i.minHeight.pushAll(t.minHeight);i.$el.css("transition","top "+r.transition);t.$el.css("pointer-events","none");i.$el.css("pointer-events","initial");i.$el.css("z-index","1000");return[{width:n.width,height:i.minHeight,top:Stream.combine([e,i.minHeight],function(t,n){return t?0:-n}),left:Stream.once(0)}]}),$css("overflow","hidden")])),child(t),wireChildren(function(t,n,e,r){Stream.combine([e.minWidth,r.minWidth],Math.max).pushAll(t.minWidth);r.minHeight.pushAll(t.minHeight);return[{width:n.width,height:e.minHeight,top:n.height,left:Stream.once(0)},{width:n.width,height:n.height,top:Stream.once(0),left:Stream.once(0)}]})])};var fixedHeaderBody=function(t,n,e){t.transition=t.transition||"0.5s";return div.all([componentName("fixedHeaderBody"),child(e),child(n),wireChildren(function(n,e,r,i){i.$el.css("position","fixed");setTimeout(function(){i.$el.css("transition","height "+t.transition);r.$el.css("transition","top "+t.transition)});Stream.combine([r,i].map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);return t.reduce(add,0)}).pushAll(n.minHeight);Stream.combine([r,i].map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);return t.reduce(mathMax,0)}).pushAll(n.minWidth);return[{top:i.minHeight,left:Stream.once(0),width:e.width,height:r.minHeight},{top:Stream.once(0),left:Stream.once(0),width:e.width,height:i.minHeight}]})])};var stickyHeaderBody=function(t,n,e){return div.all([componentName("stickyHeaderBody"),child(t),child(e),child(n),wireChildren(function(t,n,e,r,i){Stream.combine([e,r,i].map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);return t.reduce(add,0)}).pushAll(t.minHeight);var o=false;return[{top:Stream.once(0),left:Stream.once(0),width:n.width,height:e.minHeight},{top:Stream.combine([e.minHeight,i.minHeight],add),left:Stream.once(0),width:n.width,height:r.minHeight},{top:Stream.combine([e.minHeight,n.scroll,n.topAccum],function(t,n,e){var r=i.$el;t=Math.floor(t);if(t>n+e){r.css("position","absolute");r.css("transition","");if(o){window.scrollTo(0,t+e)}o=false;return t}else if(t<n+e){r.css("position","fixed");setTimeout(function(){r.css("transition","inherit")},20);if(!o){window.scrollTo(0,t+e)}o=true;return e}}),left:Stream.once(0),width:n.width,height:i.minHeight}]})])};var grid=function(t,n){t.gutterSize=t.gutterSize||0;t.handleSurplusWidth=t.handleSurplusWidth||ignoreSurplusWidth;t.handleSurplusHeight=t.handleSurplusHeight||ignoreSurplusHeight;return padding(t.outerGutter?t.gutterSize:0,div.all([componentName("grid"),children(n),wireChildren(function(n,e,r){if(r.length===0){n.minWidth.push(0);n.minHeight.push(0)}var i=Stream.combine(r.map(function(t){return t.minWidth}),function(){return Array.prototype.slice.call(arguments)});var o=Stream.combine(r.map(function(t){return t.minHeight}),function(){return Array.prototype.slice.call(arguments)});i.map(function(n){return n.reduce(function(n,e){return t.useFullWidth?n+e+t.gutterSize:Math.max(n,e)+t.gutterSize},-t.gutterSize)}).pushAll(n.minWidth);var a=r.map(function(t){return{top:Stream.never(),left:Stream.never(),width:Stream.never(),height:Stream.never()}});var u=Stream.combine([e.width,i],function(n,e){var i=function(){return{cells:[],contexts:[],height:0}};var o=r.reduce(function(r,o,u){var h=r.rows;var l=r.currentRow;var c=e[u];var s=l.cells.reduce(function(n,e){return n+e+t.gutterSize},0);var m=Math.min(c,n);if(m>0&&m+s>n){h.push(l);l=i()}l.cells.push(m);l.contexts.push(a[u]);return{rows:h,currentRow:l}},{rows:[],currentRow:i()});var u=o.rows;u.push(o.currentRow);u.map(function(e,r){var i=0;var o=e.cells.map(function(n){var e={left:i,width:n};i+=n+t.gutterSize;return e});o=t.handleSurplusWidth(n,o,t,r);o.map(function(t,n){var r=e.contexts[n];r.width.push(t.width)})});return u});var h=Stream.combine([o,u],function(e,r){var i=0;r.map(function(t){t.height=0;t.cells.map(function(n,r){t.height=Math.max(t.height,e[i+r])});i+=t.cells.length});n.minHeight.push(r.map(function(t){return t.height}).reduce(function(n,e){return n+e+t.gutterSize},-t.gutterSize));return r});Stream.all([e.width,e.height,h],function(n,e,r){if(t.bottomToTop){r=r.slice(0).reverse()}var i=0;r=t.handleSurplusHeight(e,r,t);r.map(function(e,r){var o=0;var a=e.cells.map(function(n){var r={top:i,left:o,width:n,height:e.height};o+=n+t.gutterSize;return r});a=t.handleSurplusWidth(n,a,t,r);a.map(function(t,n){var r=e.contexts[n];r.top.push(t.top);r.left.push(t.left);r.width.push(t.width);r.height.push(t.height)});i+=e.height+t.gutterSize})});return[a]})]))};var backgroundImagePosition={fit:"fit",fill:"fill"};var withMinHeightStream=function(t,n){return div.all([componentName("with-min-height-stream"),child(n),wireChildren(function(n,e,r){t(r,e).pushAll(n.minHeight);r.minWidth.pushAll(n.minWidth);return[{top:Stream.once(0),left:Stream.once(0),width:e.width,height:e.height}]})])};var extendToWindowBottom=function(t,n){n=n||Stream.once(0);return withMinHeightStream(function(t,e){return Stream.combine([t.minHeight,e.top,e.topAccum,n,windowResize],function(t,n,e,r){return Math.max(t,window.innerHeight-n-e-r)})},t)};var atMostWindowBottom=function(t,n){n=n||Stream.once(0);return withMinHeightStream(function(t,e){return Stream.combine([t.minHeight,e.top,e.topAccum,n,windowResize],function(t,n,e,r){return Math.min(t,window.innerHeight-n-e-r)})},t)};var overlays=function(t){return div.all([children(t),wireChildren(function(t,n,e){var r=function(t){return Stream.combine(t,function(){var t=Array.prototype.slice.call(arguments);return t.reduce(mathMax,0)})};r(e.map(function(t){return t.minHeight})).pushAll(t.minHeight);r(e.map(function(t){return t.minWidth})).pushAll(t.minWidth);return[e.map(function(t){return{top:Stream.once(0),left:Stream.once(0),width:n.width,height:n.height}})]})])};var withBackground=function(t,n){return div.all([componentName("with-background"),child(t),child(n),wireChildren(function(t,n,e,r){r.minWidth.pushAll(t.minWidth);r.minHeight.pushAll(t.minHeight);var i={top:Stream.once(0),left:Stream.once(0),width:n.width,height:n.height};return[i,i]})])};var withBackgroundImage=function(t,n){var e=Stream.once(t.aspectRatio||1);if(!t.src.map){t.src=Stream.once(t.src)}return div.all([componentName("with-background-image"),$css("overflow","hidden"),child(img.all([$css("visibility","hidden"),function(n,r){n.minWidth.push(0);n.minHeight.push(0);t.src.map(function(t){n.$el.prop("src",t)});n.$el.on("load",function(){var t=findMinWidth(n.$el);var r=findMinHeight(n.$el);var i=t/r;e.push(i)});Stream.all([r.width,r.height],function(){n.$el.css("visibility","")})}])),child(n),wireChildren(function(t,n,r,i){i.minWidth.pushAll(t.minWidth);i.minHeight.pushAll(t.minHeight);var o=t.newCtx();n.top.push(0);n.left.push(0);n.width.pushAll(o.width);n.height.pushAll(o.height);var a=t.newCtx();a.top.push(0);a.left.push(0);Stream.all([e,n.width,n.height],function(t,n,e){var r=n/e;if(t<r){a.width.push(n);a.height.push(n/t)}else{a.width.push(e*t);a.height.push(e)}});return[a,o]})])};var table=function(t,n){t=t||{};var e=(t.paddingSize||0)*2;return div.all(n.map(function(t){return children(t)})).all([componentName("table"),wireChildren(function(){var t=Array.prototype.slice.call(arguments);var n=t[0];var r=t[1];var i=t.slice(2);var o=Stream.combine(i.reduce(function(t,n){t.push(Stream.combine(n.map(function(t){return t.minWidth}),function(){return Array.prototype.slice.call(arguments)}));return t},[]),function(){var t=Array.prototype.slice.call(arguments);return t.reduce(function(t,n){return n.map(function(n,e){return Math.max(t[e]||0,n)})},[])});o.map(function(t){var r=t.reduce(function(t,n){return t+n+e},-e);n.minWidth.push(r)});var a=i.reduce(function(t,n){t.push(Stream.combine(n.map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);return t.reduce(mathMax,0)}));return t},[]);Stream.combine(a,function(){var t=Array.prototype.slice.call(arguments);var r=t.reduce(function(t,n){return t+n+e},-e);n.minHeight.push(r)});return a.map(function(t,n){return i[n].map(function(t,r){return{width:o.map(function(t){return t[r]}),height:a[n],top:Stream.combine(a.slice(0,n).concat([Stream.once(0)]),function(){var t=Array.prototype.slice.call(arguments);return t.reduce(function(t,n){return t+n+e},-e)}),left:o.map(function(t){return t.reduce(function(t,n,i){return t+(i<r?n+e:0)},0)})}})})})])};var tabs=function(t,n){var e=n||Stream.once(0);return stack({},[sideBySide({handleSurplusWidth:centerSurplusWidth},t.map(function(t,n){return alignTBM({bottom:toggleComponent([t.tab.left,t.tab.right,t.tab.selected],e.map(function(t){if(n<t){return 0}if(n>t){return 1}return 2})).all([link,clickThis(function(){e.push(n)})])})})),componentStream(e.map(function(n){return t[n].content}))])};var matchStrings=function(t){return function(n){for(var e=0;e<t.length;e++){var r=t[e];if(n.indexOf(r.string)===0){return r.router(n.substring(r.string.length))}}}};var routeToComponent=function(t){return function(){return t}};var routeToComponentF=function(t){return function(){return t()}};var routeToFirst=function(t){return function(n){for(var e=0;e<t.length;e++){var r=t[e](n);if(r){return r}}}};var routeMatchRest=function(t){return function(n){return Q(n).then(t)}};var ignoreHashChange=false;var route=function(t){var n;return div.all([child(div.all([componentName("route"),function(e,r){windowHash.onValue(function(i){if(ignoreHashChange){ignoreHashChange=false;return}if(n){n.destroy()}Q.all([t(i)]).then(function(t){var i=t[0];n=i.create(r);n.$el.css("transition","inherit");n.minWidth.pushAll(e.minWidth);n.minHeight.pushAll(e.minHeight)},function(t){console.error("child components failed to load");console.log(t)})})}])),wireChildren(passThroughToFirst)])};