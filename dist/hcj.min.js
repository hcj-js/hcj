var apply=function(t){return function(n){return n(t)}};var constant=function(t){return function(n){return t}};var curry=function(t){throw"the venerable curry, we shall define at a later date"};var id=function(t){return t};var add=function(t,n){return t+n};var subtract=function(t,n){return t-n};var mathMax=function(t,n){return Math.max(t,n)};var mathMin=function(t,n){return Math.min(t,n)};var px=function(t){return t+"px"};var pushStreams=[];var pushValues=[];var pushing=false;var pushFlush=function(){var t=pushStreams;var n=pushValues;pushStreams=[];pushValues=[];pushing=false;for(var r=0;r<t.length;r++){var e=t[r];var i=n[r]}};var pushNow=function(t,n){pushStreams.push(t);pushValues.push(n);if(pushing===false){pushing=true;setTimeout(function(){setTimeout(pushFlush)})}};var stream={create:function(){return{listeners:[],lastValue:undefined}},isStream:function(t){return t&&t.hasOwnProperty("listeners")&&t.hasOwnProperty("lastValue")},once:function(t){var n=stream.create();stream.push(n,t);return n},push:function(t,n){if(t.lastValue!==n){t.lastValue=n;for(var r=0;r<t.listeners.length;r++){if(t.listeners[r]){t.listeners[r](n)}}}},map:function(t,n){var r=stream.create();if(t.lastValue!==undefined){stream.push(r,n(t.lastValue))}t.listeners.push(function(t){stream.push(r,n(t))});return r},reduce:function(t,n,r){var e=stream.once(r);if(t.lastValue!==undefined){stream.push(e,n(e.lastValue,t.lastValue))}t.listeners.push(function(t){stream.push(e,n(e.lastValue,t))});return e},filter:function(t,n){var r=stream.create();t.listeners.push(function(t){if(n(t)){stream.push(r,t)}});return stream},onValue:function(t,n){stream.map(t,function(t){n(t);return true});var r=t.listeners.length-1;return function(){delete t.listeners[r]}},promise:function(t){var n=$.Deferred();stream.map(t,function(t){n.resolve(t)});return n.promise},prop:function(t,n){return stream.map(t,function(t){return t[n]})},delay:function(t,n){var r=stream.create();stream.map(t,function(t){setTimeout(function(){stream.push(r,t)},n)});return r},debounce:function(t,n){var r=stream.create();var e=0;var i=false;stream.map(t,function(a){if(!i){i=true;var u=(new Date).getTime();setTimeout(function(){i=false;stream.push(r,t.lastValue);e=Math.max(e+n,u)},Math.max(0,e+n-u))}});return r},pushAll:function(t,n){if(t.lastValue!==undefined){stream.push(n,t.lastValue)}return stream.onValue(t,function(t){stream.push(n,t)})},combine:function(t,n){var r=[];var e=stream.create();var i=false;var a=function(){if(!i){i=true;setTimeout(function(){i=false;for(var a=0;a<t.length;a++){if(r[a]===undefined){return}}stream.push(e,n.apply(null,r))})}};t.reduce(function(t,n){if(n.lastValue!==undefined){r[t]=n.lastValue;a()}stream.onValue(n,function(n){r[t]=n;a()});return t+1},0);return e},combineInto:function(t,n,r){var e=[];var i=false;var a=function(){if(!i){i=true;setTimeout(function(){i=false;for(var a=0;a<t.length;a++){if(e[a]===undefined){return}}stream.push(r,n.apply(null,e))})}};t.reduce(function(t,n){if(n.lastValue!==undefined){e[t]=n.lastValue;a()}stream.onValue(n,function(n){e[t]=n;a()});return t+1},0)},all:function(t,n){return stream.combine(t,function(){n.apply(null,arguments);return true})},combineObject:function(t){var n=Object.keys(t);var r={};var e=stream.create();var i=false;var a=function(){if(!i){i=true;setTimeout(function(){i=false;for(var t=0;t<n.length;t++){var a=n[t];if(r[a]===undefined){return}}stream.push(e,$.extend({},r))})}};n.map(function(n,e){stream.onValue(t[n],function(t){r[n]=t;a()})});return e},splitObject:function(t){var n=Object.keys(t);var r={};n.map(function(n){r[n]=stream.once(t[n])});return r},fromEvent:function(t,n){var r=stream.create();t.on("event",function(t){stream.push(r,t)});return r},fromPromise:function(t,n){var r=stream.create();if(n){stream.push(r,n)}t.then(function(t){stream.push(r,t)});return r},cases:function(t,n){t.push(n);return stream.combine(t,function(){var t=Array.prototype.slice.call(arguments);var n=t.pop();return t[n]})}};var onceZeroS=stream.once(0);var updateDomEls=[];var updateDomProps=[];var updateDomValues=[];var runDomFuncs=function(){for(var t=0;t<updateDomEls.length;t++){updateDomEls[t].css(updateDomProps[t],updateDomValues[t])}updateDomEls=[];updateDomProps=[];updateDomValues=[]};var updateDomFunc=function(t,n,r){if(updateDomEls.length===0){setTimeout(runDomFuncs)}updateDomEls.push(t);updateDomProps.push(n);updateDomValues.push(r)};var measureWidth=function(t,n){var r=$(".sandbox");var e=t.text().indexOf("Log In")!==-1;var i=t.clone();i.css("width",n?px(n):"").css("height","").css("display","inline-block").appendTo(r);var a=i[0].scrollWidth;i.remove();return a};var measureHeight=function(t){return function(n){var r=$(".sandbox");var e=t.clone();e.css("width",px(n)).css("height","").appendTo(r);var i=parseInt(e.css("height"));e.remove();return i}};var el=function(t,n,r){var e=$(document.createElement(t));if(t==="textarea"){}var i=[];r.child=function(t){t=t||{};["width","height","top","left","widthCss","heightCss","topCss","leftCss"].map(function(n){if(t[n]===true){t[n]=stream.create()}});return{$el:e,width:t.width||r.width,height:t.height||r.height,top:t.top||onceZeroS,left:t.left||onceZeroS,widthCss:t.widthCss,heightCss:t.heightCss,topCss:t.topCss,leftCss:t.leftCss,topAccum:stream.combine([r.topAccum,r.top],add),leftAccum:stream.combine([r.leftAccum,r.left],add),unbuild:i.push}};var a={$el:e};var u=n(e,r,function(t){var n=measureWidth(e,t);if(a.minWidth){stream.push(a.minWidth,n)}else{a.initialMinWidth=n}},function(){var t=measureHeight(e);if(a.minHeight){stream.push(a.minHeight,t)}else{a.initialMinHeight=t}})||{};a.minWidth=u.minWidth?u.minWidth:stream.create();a.minHeight=u.minHeight?u.minHeight:stream.create();if(a.initialMinWidth){stream.push(a.minWidth,a.initialMinWidth)}if(a.initialMinHeight){stream.push(a.minHeight,a.initialMinHeight)}e.appendTo(r.$el);e.before(" ");e.after(" ");a.destroy=function(){i.map(apply());e.remove()};return a};var callEl=function(t){return function(n){return function(r){return el(t,n,r)}}};var a=callEl("a");var button=callEl("button");var div=callEl("div");var form=callEl("form");var iframe=callEl("iframe");var img=callEl("img");var input=callEl("input");var label=callEl("label");var li=callEl("li");var option=callEl("option");var p=callEl("p");var select=callEl("select");var textarea=callEl("textarea");var ul=callEl("ul");var stream=stream;var apply=apply;var constant=constant;var curry=curry;var id=id;var add=add;var subtract=subtract;var mathMax=mathMax;var mathMin=mathMin;var measureWidth=measureWidth;var measureHeight=measureHeight;var updateDomFunc=updateDomFunc;var caseSplit=function(t,n){if(!n){return function(n){for(var r in t){if(t.hasOwnProperty(r)&&n.hasOwnProperty(r)){if(!$.isFunction(t[r])){return t[r]}return t[r](n[r])}}}}for(var r in t){if(t.hasOwnProperty(r)&&n.hasOwnProperty(r)){if(!$.isFunction(t[r])){return t[r]}return t[r](n[r])}}};var _scrollbarWidth=function(){var t,n,r;if(r===undefined){t=$('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");n=t.children();r=n.innerWidth()-n.height(99).innerWidth();t.remove()}return r};var unit=function(t){return function(n){return n+t}};var px=unit("px");var vw=unit("vw");var onceZeroS=stream.once(0);var windowWidth=stream.create();var windowHeight=stream.create();var updateWindowWidth=function(){stream.push(windowWidth,window.innerWidth)};var updateWindowHeight=function(){stream.push(windowHeight,window.innerHeight)};$(updateWindowWidth);$(updateWindowHeight);$(window).on("resize",function(){updateWindowWidth();updateWindowHeight()});var windowResize=stream.once(null,true);$(window).on("resize",function(t){stream.push(windowResize,t)});var windowScroll=stream.create(true);$(window).on("scroll",function(){stream.push(windowScroll,window.scrollY)});stream.push(windowScroll,window.scrollY);var windowHash=stream.create(true);$(window).on("hashchange",function(){stream.push(windowHash,location.pathname)});stream.push(windowHash,location.pathname);var layoutRecurse=function(t,n,r){if($.isArray(r)){return r.map(function(r){return layoutRecurse(t,n,r)})}else{return function(t){var e=r(t);if(!e.minWidth||!e.minHeight){console.log("not a component");debugger}n.unbuild(e.destroy);e.$el.css("visibility","hidden").css("position","absolute").css("pointer-events","initial");stream.onValue(t.widthCss||t.width,function(t){updateDomFunc(e.$el,"width",t)});stream.onValue(t.heightCss||t.height,function(t){updateDomFunc(e.$el,"height",t)});stream.onValue(t.topCss||t.top,function(t){updateDomFunc(e.$el,"top",t)});stream.onValue(t.leftCss||t.left,function(t){updateDomFunc(e.$el,"left",t)});stream.combine([t.width,t.height,t.top,t.left],function(){updateDomFunc(e.$el,"visibility","initial")});return e}}};var layout=function(t,n){var r=n?t:div;var e=n||t;return function(){var t=Array.prototype.slice.call(arguments);return r(function(n,r){n.css("pointer-events","none").css("position","relative");return e.apply(null,[n,r].concat(layoutRecurse(n,r,t)))})}};var container=function(t,n){var r=n?t:div;var e=n||t;return div(function(t,n){return e(t,n,function(r){return layoutRecurse(t,n,r)})})};var all=function(t){return function(n){return t.reduce(function(t,n){return n(t)},n)}};var rootComponent=function(t){var n=_scrollbarWidth();var r=stream.create();var e=stream.create();var i=stream.create();stream.combine([windowWidth,windowHeight,i],function(t,i,a){var u=a(t);if(u>i){var o=a(t-n);if(o>i){$("body").css("overflow-y","initial");stream.push(r,t-n);stream.push(e,o)}else{$("body").css("overflow-y","scroll");stream.push(r,t-n);stream.push(e,o)}}else{$("body").css("overflow-y","initial");stream.push(r,t);stream.push(e,u)}});var a=[];var u=t({$el:$("body"),width:r,height:e,top:onceZeroS,left:onceZeroS,topAccum:onceZeroS,leftAccum:onceZeroS,unbuild:a.push});u.$el.css("position","absolute");var o=u.destroy;u.destroy=function(){a.map(apply());o()};stream.pushAll(u.minHeight,i);stream.all([r,e],function(t,n){u.$el.css("width",px(t)).css("height",px(n))});return u};var color=function(t){return $.extend({r:0,g:0,b:0,a:1},t)};var multiplyColor=function(t){return function(n){return{r:Math.min(255,n.r*t),g:Math.min(255,n.g*t),b:Math.min(255,n.b*t),a:n.a}}};var desaturate=function(t){return function(n){var r=(n.r+n.g+n.b)/3;var e=1-t;return{r:e*n.r+t*r,g:e*n.g+t*r,b:e*n.b+t*r,a:n.a}}};var colorBrightness=function(t){return(t.r+t.g+t.b)/(255+255+255)};var colorString=function(t){return"rgba("+Math.floor(t.r)+","+Math.floor(t.g)+","+Math.floor(t.b)+","+t.a+")"};var rgbColorString=function(t){return"rgb("+Math.floor(t.r)+","+Math.floor(t.g)+","+Math.floor(t.b)+")"};var transparent=color({a:0});var black=color({r:0,g:0,b:0});var white=color({r:255,g:255,b:255});var mapMinWidths=function(t){return stream.combine(t.map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);return t})};var mapMinHeights=function(t){return stream.combine(t.map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);return t})};var url=function(t){return'url("'+t+'")'};var and=function(t){return function(n){return function(r){var e=n(r);t(e,r);return e}}};var $$=function(t){return and(function(n){return t(n.$el)})};var jqueryMethod=function(t){return function(){var n=Array.prototype.slice.call(arguments);return $$(function(r){r[t].apply(r,n)})}};var $addClass=jqueryMethod("addClass");var $attr=jqueryMethod("attr");var $css=jqueryMethod("css");var $on=jqueryMethod("on");var $prop=jqueryMethod("prop");var useMinWidth=function(t,n){return stream.pushAll(n.minWidth,t.width)};var useMinHeight=function(t,n){return stream.combineInto([t.width,n.minHeight],function(t,n){return n(t)},t.height)};var withMinWidth=function(t){return layout(function(n,r,e){n.addClass("withMinWidth");var i=e(r.child());return{minWidth:stream.once(t),minHeight:i.minHeight}})};var withMinHeight=function(t){return layout(function(n,r,e){n.addClass("withMinHeight");var i=e(r.child());return{minWidth:i.minWidth,minHeight:stream.once(constant(t))}})};var withDimensions=function(t,n){return layout(function(r,e,i){r.addClass("withDimensions");var a=i(e.child());return{minWidth:stream.once(t),minHeight:stream.once(constant(n))}})};var passthrough=function(t){return layout(function(n,r,e){n.addClass("passthrough");t(n);return e(r.child())})};var adjustPosition=function(t,n){t=t||{};t.minWidth=t.minWidth||id;t.minHeight=t.minHeight||id;n=n||{};n.top=n.top||onceZeroS;n.left=n.left||onceZeroS;n.width=n.width||id;n.height=n.height||id;return layout(function(r,e,i){var a=e.child({top:true,left:true,width:true,height:true});var u=i(a);stream.pushAll(n.top,a.top);stream.pushAll(n.left,a.left);stream.pushAll(stream.map(e.width,n.width),a.width);stream.pushAll(stream.map(e.height,n.height),a.height);return{minWidth:stream.map(u.minWidth,function(n){return t.minWidth(n)}),minHeight:stream.map(u.minHeight,function(n){return t.minHeight(n)})}})};var adjustMinSize=function(t){return layout(function(n,r,e){var i=e(r.child());return{minWidth:stream.map(i.minWidth,function(n){return t.mw(n)}),minHeight:stream.map(i.minHeight,function(n){return t.mh(n)})}})};var link=$css("cursor","pointer");var onThis=function(t){return function(n){return $on(t,n)}};var changeThis=onThis("change");var clickThis=onThis("click");var inputPropertychangeThis=onThis("input propertychange");var keydownThis=onThis("keydown");var keyupThis=onThis("keyup");var mousedownThis=onThis("mousedown");var mousemoveThis=onThis("mousemove");var mouseoverThis=onThis("mouseover");var mouseoutThis=onThis("mouseout");var mouseupThis=onThis("mouseup");var submitThis=onThis("submit");var pushOnClick=function(t,n){return clickThis(function(r){stream.push(t,n(r))})};var hoverThis=function(t){return passthrough(function(n){t(false,n);n.on("mouseover",function(r){t(true,n,r)});n.on("mouseout",function(r){t(false,n,r)})})};var cssStream=function(t,n){return passthrough(function(r){stream.map(n,function(n){r.css(t,n)})})};var withBackgroundColor=function(t,n){if(!stream.isStream(t)){t=stream.once({backgroundColor:t,fontColor:n})}return $$(function(n){stream.map(t,function(t){var r=t.backgroundColor;var e=t.fontColor;if(r){n.css("background-color",colorString(r))}if(e){n.css("color",colorString(e))}})})};var crop=function(t){var n=t.all||0,r=t.all||0,e=t.all||0,i=t.all||0;if($.isNumeric(t)){n=r=e=i=t}else{for(var a in t){var u=a.toLowerCase();if(t[a]!==null){if(u.indexOf("top")!==-1){n=t[a]}if(u.indexOf("bottom")!==-1){r=t[a]}if(u.indexOf("left")!==-1){e=t[a]}if(u.indexOf("right")!==-1){i=t[a]}}}}return layout(function(t,a,u){t.addClass("crop");t.css("overflow","hidden");var o=stream.create();var s=u(a.child({top:stream.prop(o,"top"),left:stream.prop(o,"left"),width:stream.prop(o,"width"),height:stream.prop(o,"height")}));var h=stream.create();var c=stream.create();stream.combineInto([s.minWidth,s.minHeight,a.width,a.height],function(t,a,u,o){var s=u/(1-e-i);var h=o/(1-n-r);return{top:-n*h,left:-e*s,width:s,height:h}},o);stream.combine([s.minWidth,s.minHeight],function(t,a){stream.push(h,t*(1-e-i));stream.push(c,function(u){return a(t/(1-e-i))*(1-n-r)})});return{minWidth:h,minHeight:c}})};var keepAspectRatio=function(t){t=t||{};return layout(function(n,r,e){n.addClass("keepAspectRatio");n.css("overflow","hidden");var i=stream.create();var a=e(r.child({top:stream.prop(i,"top"),left:stream.prop(i,"left"),width:stream.prop(i,"width"),height:stream.prop(i,"height")}));stream.combineInto([a.minWidth,a.minHeight,r.width,r.height],function(n,r,e,i){var a=n/r(n);var u=e/i;if(!t.fill&&u>a||t.fill&&u<a){var o=i*a;var s;if(t.left){s=0}else if(t.right){s=e-o}else{s=(e-o)/2}return{top:0,left:s,width:o,height:i}}else{var h=e/a;var c;if(t.top){c=0}else if(t.bottom){c=i-h}else{c=(i-h)/2}return{top:c,left:0,width:e,height:h}}},i);var u=stream.create();var o=stream.create();stream.combine([a.minWidth,a.minHeight],function(n,r){if(t.minWidth){stream.push(u,t.minWidth)}else if(t.minHeight){stream.push(u,t.minHeight*n/r(n))}else{stream.push(u,n)}stream.push(o,function(t){return t/(n/r(n))})});return{minWidth:u,minHeight:o}})};var image=function(t){var n=stream.isStream(t.src)?t.src:stream.once(t.src);return img(function(r,e){var i=stream.create();var a=stream.create();stream.map(n,function(t){r.prop("src",t)});r.on("load",function(){var n=r[0].naturalWidth/r[0].naturalHeight;var e=t.minWidth||t.minHeight&&t.minHeight*n||r[0].naturalWidth;stream.push(i,e);stream.push(a,function(t){return t/n})});return{minWidth:i,minHeight:a}})};var linkTo=function(t){return layout(a,function(n,r,e){n.prop("href",t);n.css("pointer-events","initial");return e(r.child())})};var nothing=div(function(t,n){return{minWidth:onceZeroS,minHeight:stream.once(constant(0))}});var text=function(t,n){t=t||"";if(!$.isArray(t)){t=[t]}n=n||t[0];if($.isArray(n)){n=n.reduce($.extend,{})}return(n.el||div)(function(r,e){var i=false;var a=stream.create();var u=stream.create();t.map(function(t){if($.type(t)==="string"){t={str:t}}var e=$(document.createElement("span"));e.html(t.str);if(t.size||n.size){e.css("font-size",t.size)}if(t.weight){e.css("font-weight",t.weight)}if(t.family){e.css("font-family",t.family)}if(t.color){e.css("color",colorString(t.color))}if(t.spanCSS){t.spanCSS.map(function(t){e.css(t.name,t.value)})}if(t.linkTo){var i=$(document.createElement("a"));i.prop("href",t.linkTo).appendTo(r);e.appendTo(i)}else{e.appendTo(r)}});if(n.size){r.css("font-size",n.size)}if(n.weight){r.css("font-weight",n.weight)}if(n.family){r.css("font-family",n.family)}if(n.color){r.css("color",colorString(n.color))}if(n.align){r.css("text-align",n.align)}stream.push(a,n.hasOwnProperty("minWidth")?n.minWidth:measureWidth(r));stream.push(u,n.hasOwnProperty("minHeight")?constant(n.minHeight):measureHeight(r));return{minWidth:a,minHeight:u}})};var ignoreSurplusWidth=function(t,n){return n};var ignoreSurplusHeight=function(t,n){return n};var centerSurplusWidth=function(t,n){var r=n[n.length-1];var e=t-(r.left+r.width);var i=e/n.length;n.map(function(t,n){t.left+=e/2});return n};var evenSplitSurplusWidth=function(t,n){var r=n[n.length-1];var e=t-(r.left+r.width);var i=e/n.length;n.map(function(t,n){t.width+=i;t.left+=n*i});return n};var evenSplitSurplusWidthWithMinPerRow=function(t){return function(n,r){var e=r[r.length-1];var i=n-(e.left+e.width);var a=n/Math.max(t,r.length);r.map(function(t,n){t.width=a;t.left=n*a});e=r[r.length-1];i=n-(e.left+e.width);a=i/r.length;r.map(function(t,n){t.left+=i/2});return r}};var justifySurplusWidth=function(t,n){var r=n[n.length-1];var e=t-(r.left+r.width);n.map(function(t,r){for(var i=0;i<r;i++){t.left+=e/(n.length-1)}});return n};var justifyAndCenterSurplusWidth=function(t,n){var r=n[n.length-1];var e=t-(r.left+r.width);n.map(function(t,r){t.left+=r*e/n.length+e/(2*n.length)});return n};var surplusWidthAlign=function(t){return function(n,r){var e=r[r.length-1];var i=n-(e.left+e.width);r.map(function(n,r){n.left+=t*i});return r}};var surplusWidthAlignLeft=surplusWidthAlign(0);var surplusWidthAlignCenter=surplusWidthAlign(.5);var surplusWidthAlignRight=surplusWidthAlign(1);var superSurplusWidth=function(t,n){var r=n[n.length-1];var e=t-(r.left+r.width);if(n.length===1){if(e<n[0].width){return evenSplitSurplusWidth(t,n)}else{return n}}if(n.length===2){return justifyAndCenterSurplusWidth(t,n)}return justifySurplusWidth(t,n)};var giveToNth=function(t){return function(n,r){var e=r[r.length-1];var i=n-(e.left+e.width);r.map(function(n,e){if(e===t||e===r.length-1&&t>=r.length){n.width+=i}else if(e>t){n.left+=i}});return r}};var giveToFirst=giveToNth(0);var giveToSecond=giveToNth(1);var giveToThird=giveToNth(2);var centerSurplusHeight=function(t,n){var r=n[n.length-1];var e=t-(r.top+r.height);n.map(function(t,n){t.top+=e/2});return n};var evenSplitSurplusHeight=function(t,n){var r=n[n.length-1];var e=t-(r.top+r.height);var i=e/n.length;n.map(function(t,n){t.height+=i;t.top+=n*i});return n};var giveHeightToNth=function(t){return function(n,r){var e=r[r.length-1];var i=n-(e.top+e.height);r.map(function(n,e){if(e===t||e===r.length-1&&t>=r.length){n.height+=i}else if(e>t){n.top+=i}});return r}};var giveHeightToLast=function(t,n){var r=n.length-1;var e=n[n.length-1];var i=t-(e.top+e.height);n.map(function(t,e){if(e===r||e===n.length-1&&r>=n.length){t.height+=i}else if(e>r){t.top+=i}});return n};var sideBySide=function(t){t=t||{};t.padding=t.padding||0;t.handleSurplusWidth=t.handleSurplusWidth||ignoreSurplusWidth;return layout(function(n,r,e){n.addClass("sideBySide");if(e.length===0){return{minWidth:stream.once(0),minHeight:stream.once(constant(0))}}var i=[];var a=e.map(function(t){var n=r.child({left:true,width:true});i.push(n);return t(n)});var u=mapMinWidths(a);var o=mapMinHeights(a);var s=[o];var h=function(n,r){var e=0;var i=r.map(function(r,i){var a={left:e+t.padding*i,width:Math.min(n,r)};e+=r;return a});i=t.handleSurplusWidth(n,i);return i};stream.all([r.width,u,o,t.sourcePositionsS||stream.once([])],function(n,r,e,a){var u=h(n,r);if(t.targetPositionsS){stream.push(t.targetPositionsS,u)}a.map(function(t,n){u[n]=t});u.map(function(t,n){var r=i[n];stream.push(r.left,t.left);stream.push(r.width,t.width)})});return{minWidth:stream.map(u,function(n){return n.reduce(add,t.padding*(a.length-1))}),minHeight:stream.combine([u,o],function(t,n){return function(r){var e=h(r,t);return e.map(function(t,r){return n[r](e[r].width)}).reduce(mathMax,0)}})}})};var slideIn=function(t){t=t||{};t.top=t.top||50;t.transition=t.transition||"1s";return layout(function(n,r,e){var i=r.child({top:true});var a=e(i);a.$el.css("transition","top "+t.transition);var u=false;stream.push(i.top,t.top);stream.combine([r.topAccum,r.top,windowHeight,windowScroll],function(t,n,r,e){if(!u){var a=t+n;var o=e+r;if(a<=o){stream.push(i.top,0);u=true}}});return{minWidth:a.minWidth,minHeight:a.minHeight}})};var fadeIn=function(t){t=t||{};t.transition=t.transition||"1s";t.margin=t.margin||0;return layout(function(n,r,e){var i=e(r.child());var a=false;i.$el.css("opacity",0);setTimeout(function(){i.$el.css("transition","opacity "+t.transition)});stream.combine([r.topAccum,r.top,windowHeight,windowScroll],function(n,r,e,u){if(!a){var o=n+r;var s=u+e;if(o+t.margin<=s){i.$el.css("opacity",1);a=true}}});return{minWidth:i.minWidth,minHeight:i.minHeight}})};var stack=function(t){t=t||{};t.padding=t.padding||0;t.handleSurplusHeight=t.handleSurplusHeight||ignoreSurplusHeight;var n=t.transition+"s";return layout(function(n,r,e){n.addClass("stack");if(e.length===0){return{minWidth:stream.once(0),minHeight:stream.once(constant(0))}}var i=[];var a=e.map(function(t){var n=r.child({top:true,height:true});i.push(n);return t(n)});if(t.transition){a.map(function(n){n.$el.css("transition","height "+t.transition+", top "+t.transition)})}var u=mapMinWidths(a);var o=mapMinHeights(a);stream.all([r.width,r.height,o],function(n,r,e){var a=0;var u=e.map(function(r,e){var i={top:a+t.padding*e,height:r(n)};a+=r(n);return i});u=t.handleSurplusHeight(r,u);u.map(function(t,n){var r=i[n];stream.push(r.top,t.top);stream.push(r.height,t.height)})});return{minWidth:stream.map(u,function(t){return t.reduce(mathMax,0)}),minHeight:stream.map(o,function(n){return function(r){return n.map(apply(r)).reduce(add,t.padding*(a.length-1))}})}})};var stackStream=function(t){t=t||{};t.padding=t.padding||0;t.handleSurplusHeight=t.handleSurplusHeight||ignoreSurplusHeight;t.transition=t.transition||0;return function(n){return container(function(r,e,i){var a=stream.once(0);var u=stream.once(constant(0));var o=[];var s=[];var h=[];var c=[];var l=function(){var n=e.width.lastValue;var r=e.height.lastValue;var i=[];var h=[];s.map(function(t,n){i[n]=t.minWidth.lastValue;h[n]=t.minHeight.lastValue});if(!i.concat(h).reduce(function(t,n){return t&&n!==undefined},true)){return}stream.push(a,i.reduce(mathMax,0));stream.push(u,function(n){return h.map(apply(n)).reduce(add,t.padding*(s.length-1))});if(n===undefined){return}if(r===undefined){return}var c=0;var l=-1;var m=h.map(function(r){l+=1;var e={top:c+t.padding*l,height:r(n)};c+=r(n);return e});m=t.handleSurplusHeight(r,m);o.map(function(t,n){var r=m[n];stream.push(t.top,r.top);stream.push(t.height,r.height)})};stream.onValue(e.width,l);stream.onValue(e.height,l);var m=[];var f=-1;var d=function(t){f+=1;var n=e.child({top:true,height:true});var r=i(t)(n);m[f]=t;h[f]=stream.onValue(r.minWidth,l);c[f]=stream.onValue(r.minHeight,l);o[f]=n;s[f]=r;return f};var p=function(t){var n=m.indexOf(t);s[n].destroy();h[n]();c[n]();delete h[n];delete c[n];delete o[n];delete s[n];l()};stream.onValue(n,function(t){caseSplit({insert:d,insertMany:function(t){t.map(d)},remove:p},t)});return{minWidth:a,minHeight:u}})}};var tree=function(t,n){t=t||{};t.indent=t.indent||10;return function(n){var r=stream.once(true);return sideBySide()([componentStream(stream.map(r,function(t){})),stackStream(t)(stream.map(n,caseSplit({expand:function(t,n){},collapse:function(t){}})))])}};var margin=function(t){var n=t.all||0,r=t.all||0,e=t.all||0,i=t.all||0;if($.isNumeric(t)){n=r=e=i=t}else{for(var a in t){var u=a.toLowerCase();if(t[a]!==null){if(u.indexOf("top")!==-1){n=t[a]}if(u.indexOf("bottom")!==-1){r=t[a]}if(u.indexOf("left")!==-1){e=t[a]}if(u.indexOf("right")!==-1){i=t[a]}}}}return layout(function(t,a,u){t.addClass("margin");var o=u(a.child({top:stream.once(n),left:stream.once(e),width:stream.map(a.width,function(t){return t-e-i}),height:stream.map(a.height,function(t){return t-n-r}),widthCss:stream.once("calc(100% - "+px(e+i)+")"),heightCss:stream.once("calc(100% - "+px(n+r)+")")}));return{minWidth:stream.map(o.minWidth,function(t){return t+e+i}),minHeight:stream.map(o.minHeight,function(t){return function(a){return t(a-e-i)+n+r}})}})};var alignLRM=function(t){t=t||{};t.transition=(t.transition||0)+"s";return function(t){return layout(function(t,n,r,e,i){t.addClass("alignLRM");var a=n.child({width:true});var u=n.child({width:true,left:true});var o=n.child({width:true,left:true});var s=r(a);var h=e(u);var c=i(o);stream.combine([s.minWidth,h.minWidth,c.minWidth,n.width],function(t,n,r,e){stream.push(a.width,Math.min(e,t));stream.push(u.width,Math.min(e,n));stream.push(o.width,Math.min(e,r));stream.push(a.left,0);stream.push(u.left,e-Math.min(e,n));stream.push(o.left,(e-Math.min(e,r))/2)});return{minWidth:stream.combine([s.minWidth,h.minWidth,c.minWidth],function(t,n,r){return[t,n,r].reduce(add)}),minHeight:stream.combine([s.minWidth,h.minWidth,c.minWidth,s.minHeight,h.minHeight,c.minHeight],function(t,n,r,e,i,a){return function(u){return[e(Math.min(u,t)),i(Math.min(u,n)),a(Math.min(u,r))].reduce(mathMax)}})}})(t.l||nothing,t.r||nothing,t.m||nothing)}};var alignLeft=function(t){return alignLRM()({l:t})};var alignRight=function(t){return alignLRM()({r:t})};var center=function(t){return function(n){return alignLRM(t)({m:n})}};var alignTBM=function(t){t=t||{};t.transition=(t.transition||0)+"s";return function(n){return layout(function(n,r,e,i,a){n.addClass("alignTBM");var u=r.child({height:true});var o=r.child({height:true,top:true});var s=r.child({height:true,top:true});var h=e(u);var c=i(o);var l=a(s);stream.combine([h.minHeight,c.minHeight,l.minHeight,r.width,r.height],function(t,n,r,e,i){stream.push(u.height,Math.min(i,t(e)));stream.push(o.height,Math.min(i,n(e)));stream.push(s.height,Math.min(i,r(e)));stream.push(u.top,0);stream.push(o.top,Math.max(0,i-Math.min(i,n(e))));stream.push(s.top,Math.max(0,(i-Math.min(i,r(e)))/2))});h.$el.css("transition","top "+t.transition);c.$el.css("transition","top "+t.transition);l.$el.css("transition","top "+t.transition);return{minWidth:stream.combine([h.minWidth,c.minWidth,l.minWidth],function(t,n,r){return[t,n,r].reduce(mathMax)}),minHeight:stream.combine([h.minHeight,c.minHeight,l.minHeight],function(t,n,r){return function(e){return[t,n,r].map(apply(e)).reduce(add)}})}})(n.t||nothing,n.b||nothing,n.m||nothing)}};var alignTop=function(t){return alignTBM()({t:t})};var alignBottom=function(t){return alignTBM()({t:t})};var alignAbsoluteCenter=function(t){return alignTBM()({m:alignLRM()({m:t})})};var border=function(t,n,r){var e=n.left||n.all||0;var i=n.right||n.all||0;var a=n.top||n.all||0;var u=n.bottom||n.all||0;var o=n.radius||0;if($.isNumeric(n)){a=u=e=i=n}r=r||"solid";if(!stream.isStream(t)){t=stream.once(t)}var s=stream.map(t,colorString);return layout(function(t,n,h){t.addClass("border");var c=h(n.child({width:stream.map(n.width,function(t){return t-e-i}),height:stream.map(n.height,function(t){return t-a-u}),widthCss:stream.once("calc(100% - "+px(e+i)+")"),heightCss:stream.once("calc(100% - "+px(a+u)+")")}));c.$el.css("overflow","hidden");c.$el.css("border-radius",px(o));stream.map(s,function(t){c.$el.css("border-left",px(e)+" "+r+" "+t).css("border-right",px(i)+" "+r+" "+t).css("border-top",px(a)+" "+r+" "+t).css("border-bottom",px(u)+" "+r+" "+t)});return{minWidth:stream.map(c.minWidth,function(t){return t+e+i}),minHeight:stream.map(c.minHeight,function(t){return function(n){return t(n)+a+u}})}})};var componentStream=function(t){var n=new Error;return container(function(n,r,e){n.addClass("componentStream");var i;var a;var u;r.unbuild(function(){if(i){i.destroy()}});var o=stream.create();var s=stream.create();var h=stream.reduce(t,function(t,n){if(t){t.destroy()}if(a){a()}if(u){u()}t=e(n)(r.child({widthCss:stream.once("100%"),heightCss:stream.once("100%")}));a=stream.pushAll(t.minWidth,o);u=stream.pushAll(t.minHeight,s);return t});return{minWidth:o,minHeight:s}})};var promiseComponent=function(t){var n=stream.create();Q(t).then(function(t){stream.push(n,t)},function(t){console.log(t)}).catch(function(t){console.log(t)});return componentStream(n)};var toggleHeight=function(t){return layout(function(n,r,e){n.css("overflow","hidden").addClass("toggle-height");var i=r.child();var a=e(i);return{minWidth:a.minWidth,minHeight:stream.combine([a.minHeight,t],function(t,n){return function(r){return n?t(r):0}})}})};var dropdownPanel=function(t,n,r,e){e=e||{};e.transition=e.transition||"0.5s";return layout(function(t,n,r,e){t.addClass("dropdown-panel");var i=n.child({height:true,top:true});var a=n.child();var u=e(i);var o=r(a);useMinHeight(i,u);stream.pushAll(a.height,i.top);return{minWidth:stream.map(stream.combine([u.minWidth,o.minWidth],Math.max),function(t){return t}),minHeight:o.minHeight}})(t,layout(function(t,n,i){var a=i(n.child({top:stream.combine([r,n.height],function(t,n){return t?0:-n})}));t.css("overflow","hidden");a.$el.css("transition","top "+e.transition).css("z-index",1e3);return a})(n))};var sideSlidingPanel=function(t,n,r,e){e=e||{};e.transition=e.transition||"0.5s";return layout(function(t,n,r,e){t.addClass("dropdown-panel");var i=n.child({width:true,height:true,left:true,top:true});var a=n.child();var u=e(i);var o=r(a);useMinWidth(i,u);stream.combineInto([a.height,windowHeight],function(t,n){return n-t},i.height);stream.pushAll(a.height,i.top);stream.combineInto([a.width,u.minWidth],function(t,n){return t-n},i.left);return{minWidth:stream.map(stream.combine([u.minWidth,o.minWidth],Math.max),function(t){return t}),minHeight:o.minHeight}})(t,layout(function(t,n,i){var a=i(n.child({left:stream.combine([r,n.width],function(t,n){return t?0:n})}));t.css("overflow","hidden");a.$el.css("transition","left "+e.transition).css("z-index",1e3);return a})(n))};var useNthMinHeight=function(t){return function(n,r){var e=Math.min(t,n.length-1);return r[e](n[e].width)}};var grid=function(t){t=t||{};t.padding=t.padding||0;t.handleSurplusWidth=t.handleSurplusWidth||ignoreSurplusWidth;t.handleSurplusHeight=t.handleSurplusHeight||ignoreSurplusHeight;t.rowHeight=t.rowHeight||function(t,n){return t.reduce(function(t,r,e){return Math.max(t,n[e](r.width))},0)};t.maxPerRow=t.maxPerRow||0;return function(n){return layout(function(n,r,e){n.addClass("grid");var i=stream.create();var a=stream.create();if(e.length===0){stream.push(i,0);stream.push(a,constant(0))}var u=[];var o=e.map(function(t){var n=r.child({top:true,left:true,width:true,height:true});u.push(n);return t(n)});var s=stream.combine(o.map(function(t){
return t.minWidth}),function(){return Array.prototype.slice.call(arguments)});var h=stream.combine(o.map(function(t){return t.minHeight}),function(){return Array.prototype.slice.call(arguments)});var c=function(n,r){if(t.allSameWidth){var e=r.reduce(mathMax,0);for(var i=0;i<r.length;i++){r[i]=e}}var a;var o=function(){a=0;return{cells:[],contexts:[],height:0}};var s=r.reduce(function(r,e,i){var s=r.rows;var h=r.currentRow;var c=h.cells.reduce(function(n,r){return n+r.width+t.padding},0);var l=Math.min(e,n);if(t.maxPerRow>0&&h.cells.length===t.maxPerRow||l>0&&l+c>n){s.push(h);h=o()}h.cells.push({width:l,left:a});h.contexts.push(u[i]);a+=l+t.padding;return{rows:s,currentRow:h}},{rows:[],currentRow:o()});var h=s.rows;h.push(s.currentRow);h.map(function(r,e){r.cells=t.handleSurplusWidth(n,r.cells,t,e)});return h};stream.pushAll(stream.map(s,function(n){return n.reduce(function(n,r){return t.useFullWidth?n+r+t.padding:Math.max(n,r)+t.padding},-t.padding)}),i);stream.combineInto([s,h],function(n,r){return function(e){var i=c(e,n);var a=0;var u=i.map(function(n){var e=t.rowHeight(n.cells,r.slice(a,a+n.cells.length));a+=n.cells.length;return e+t.padding}).reduce(add,-t.padding);return u}},a);stream.all([r.width,r.height,s,h],function(n,r,e,i){var a=c(n,e);var u=0;a.map(function(n){n.height=t.rowHeight(n.cells,i.slice(u,u+n.cells.length));u+=n.cells.length});if(t.bottomToTop){a=a.slice(0).reverse()}var o=0;a=t.handleSurplusHeight(r,a,t);a.map(function(r,e){var i=r.cells.map(function(t){var n={top:o,left:t.left,width:t.width,height:r.height};return n});i=t.handleSurplusWidth(n,i,t,e);i.map(function(t,n){var e=r.contexts[n];stream.push(e.top,t.top);stream.push(e.left,t.left);stream.push(e.width,t.width);stream.push(e.height,t.height)});o+=r.height+t.padding})});return{minWidth:i,minHeight:a}})(n)}};var withMinWidthStream=function(t){return layout(function(n,r,e){n.addClass("withMinWidthStream");var i=e(r.child());return{minWidth:$.isFunction(t)?t(i):t,minHeight:i.minHeight}})};var minWidthAtLeast=function(t){if(!stream.isStream(t)){t=stream.once(t)}return withMinWidthStream(function(n){return stream.combine([n.minWidth,t],mathMax)})};var withMinHeightStream=function(t){return layout(function(n,r,e){n.addClass("withMinHeightStream");var i=e(r.child());return{minWidth:i.minWidth,minHeight:$.isFunction(t)?t(i):t}})};var minHeightAtLeast=function(t){if(!stream.isStream(t)){t=stream.once(t)}return withMinHeightStream(function(n){return stream.combine([n.minHeight,t],function(t,n){return function(r){return Math.max(t(r),n)}})})};var overlays=function(t){return layout(function(t,n,r){t.addClass("overlays");var e=r.map(function(t){return t(n.child())});var i=function(t){return stream.combine(t,function(){var t=Array.prototype.slice.call(arguments);return t.reduce(mathMax,0)})};return{minWidth:stream.combine(e.map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);return t.reduce(mathMax,0)}),minHeight:stream.combine(e.map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);return function(n){return t.map(apply(n)).reduce(mathMax,0)}})}})};var matchStrings=function(t){return function(n){for(var r=0;r<t.length;r++){var e=t[r];if(n.indexOf(e.string)===0){return e.router(n.substring(e.string.length))}}}};var routeToComponent=function(t){return function(){return t}};var routeToComponentF=function(t){return function(){return t()}};var routeToFirst=function(t){return function(n){for(var r=0;r<t.length;r++){var e=t[r](n);if(e){return e}}}};var routeMatchRest=function(t){return function(n){return promiseComponent(Q(n).then(t))}};var route=function(t,n){return componentStream(stream.map(t,function(t){return n(t)}))};