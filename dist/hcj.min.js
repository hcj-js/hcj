var apply=function(t){return function(n){return n(t)}};var constant=function(t){return function(n){return t}};var curry=function(t){throw"the venerable curry, we shall define at a later date"};var id=function(t){return t};var add=function(t,n){return t+n};var subtract=function(t,n){return t-n};var mathMax=function(t,n){return Math.max(t,n)};var mathMin=function(t,n){return Math.min(t,n)};var px=function(t){return t+"px"};var pushStreams=[];var pushValues=[];var pushing=false;var pushFlush=function(){var t=pushStreams;var n=pushValues;pushStreams=[];pushValues=[];pushing=false;for(var e=0;e<t.length;e++){var r=t[e];var i=n[e]}};var pushNow=function(t,n){pushStreams.push(t);pushValues.push(n);if(pushing===false){pushing=true;setTimeout(function(){setTimeout(pushFlush)})}};var stream={create:function(){return{listeners:[],lastValue:undefined}},isStream:function(t){return t&&t.hasOwnProperty("listeners")&&t.hasOwnProperty("lastValue")},once:function(t){var n=stream.create();stream.push(n,t);return n},push:function(t,n){if(t.lastValue!==n){t.lastValue=n;for(var e=0;e<t.listeners.length;e++){if(t.listeners[e]){t.listeners[e](n)}}}},map:function(t,n){var e=stream.create();if(t.lastValue!==undefined){stream.push(e,n(t.lastValue))}t.listeners.push(function(t){stream.push(e,n(t))});return e},reduce:function(t,n,e){var r=stream.once(e);if(t.lastValue!==undefined){stream.push(r,n(r.lastValue,t.lastValue))}t.listeners.push(function(t){stream.push(r,n(r.lastValue,t))});return r},filter:function(t,n){var e=stream.create();t.listeners.push(function(t){if(n(t)){stream.push(e,t)}});return stream},onValue:function(t,n){stream.map(t,function(t){n(t);return true});var e=t.listeners.length-1;return function(){delete t.listeners[e]}},promise:function(t){var n=$.Deferred();stream.map(t,function(t){n.resolve(t)});return n.promise},prop:function(t,n){return stream.map(t,function(t){return t[n]})},delay:function(t,n){var e=stream.create();stream.map(t,function(t){setTimeout(function(){stream.push(e,t)},n)});return e},debounce:function(t,n){var e=stream.create();var r=0;var i=false;stream.map(t,function(a){if(!i){i=true;var o=(new Date).getTime();setTimeout(function(){i=false;stream.push(e,t.lastValue);r=Math.max(r+n,o)},Math.max(0,r+n-o))}});return e},pushAll:function(t,n){if(t.lastValue!==undefined){stream.push(n,t.lastValue)}return stream.onValue(t,function(t){stream.push(n,t)})},combine:function(t,n){var e=[];var r=stream.create();var i=false;var a=function(){if(!i){i=true;setTimeout(function(){i=false;for(var a=0;a<t.length;a++){if(e[a]===undefined){return}}stream.push(r,n.apply(null,e))})}};t.reduce(function(t,n){if(n.lastValue!==undefined){e[t]=n.lastValue;a()}stream.onValue(n,function(n){e[t]=n;a()});return t+1},0);return r},combineInto:function(t,n,e){var r=[];var i=false;var a=function(){if(!i){i=true;setTimeout(function(){i=false;for(var a=0;a<t.length;a++){if(r[a]===undefined){return}}stream.push(e,n.apply(null,r))})}};t.reduce(function(t,n){if(n.lastValue!==undefined){r[t]=n.lastValue;a()}stream.onValue(n,function(n){r[t]=n;a()});return t+1},0)},all:function(t,n){return stream.combine(t,function(){n.apply(null,arguments);return true})},combineObject:function(t){var n=Object.keys(t);var e={};var r=stream.create();var i=false;var a=function(){if(!i){i=true;setTimeout(function(){i=false;for(var t=0;t<n.length;t++){var a=n[t];if(e[a]===undefined){return}}stream.push(r,$.extend({},e))})}};n.map(function(n,r){stream.onValue(t[n],function(t){e[n]=t;a()})});return r},splitObject:function(t){var n=Object.keys(t);var e={};n.map(function(n){e[n]=stream.once(t[n])});return e},fromEvent:function(t,n){var e=stream.create();t.on("event",function(t){stream.push(e,t)});return e},fromPromise:function(t,n){var e=stream.create();if(n){stream.push(e,n)}t.then(function(t){stream.push(e,t)});return e},cases:function(t,n){t.push(n);return stream.combine(t,function(){var t=Array.prototype.slice.call(arguments);var n=t.pop();return t[n]})}};var onceZeroS=stream.once(0);var updateDomEls=[];var updateDomProps=[];var updateDomValues=[];var runDomFuncs=function(){for(var t=0;t<updateDomEls.length;t++){updateDomEls[t].css(updateDomProps[t],updateDomValues[t])}updateDomEls=[];updateDomProps=[];updateDomValues=[]};var updateDomFunc=function(t,n,e){if(updateDomEls.length===0){setTimeout(runDomFuncs)}updateDomEls.push(t);updateDomProps.push(n);updateDomValues.push(e)};var measureWidth=function(t,n){var e=$(".sandbox");var r=t.clone();r.css("width",n?px(n):"").css("height","").css("display","inline-block").appendTo(e);var i=parseFloat(r.css("width"));r.remove();return i};var measureHeight=function(t){return function(n){var e=$(".sandbox");var r=t.clone();r.css("width",px(n)).css("height","").appendTo(e);var i=parseFloat(r.css("height"));r.remove();return i}};var component=function(t,n,e){var r=$(document.createElement(t));r.css("pointer-events","initial");if(t==="textarea"){}var i=[];e.child=function(t){t=t||{};["width","height","top","left","widthCss","heightCss","topCss","leftCss"].map(function(n){if(t[n]===true){t[n]=stream.create()}});try{return{$el:r,width:t.width||e.width,height:t.height||e.height,top:t.top||onceZeroS,left:t.left||onceZeroS,widthCss:t.widthCss,heightCss:t.heightCss,topCss:t.topCss,leftCss:t.leftCss,topAccum:stream.combine([e.topAccum,e.top],add),leftAccum:stream.combine([e.leftAccum,e.left],add),unbuild:i.push}}catch(n){debugger}};var a={$el:r};var o=n(r,e,function(t){var n=measureWidth(r,t);if(a.minWidth){stream.push(a.minWidth,n)}else{a.initialMinWidth=n}},function(){var t=measureHeight(r);if(a.minHeight){stream.push(a.minHeight,t)}else{a.initialMinHeight=t}})||{};a.minWidth=o.minWidth?o.minWidth:stream.create();a.minHeight=o.minHeight?o.minHeight:stream.create();if(a.hasOwnProperty("initialMinWidth")){stream.push(a.minWidth,a.initialMinWidth)}if(a.hasOwnProperty("initialMinHeight")){stream.push(a.minHeight,a.initialMinHeight)}r.appendTo(e.$el);a.destroy=function(){i.map(apply());r.remove()};return a};var curryComponent=function(t){return function(n){return function(e){return component(t,n,e)}}};var a=curryComponent("a");var button=curryComponent("button");var div=curryComponent("div");var form=curryComponent("form");var iframe=curryComponent("iframe");var img=curryComponent("img");var input=curryComponent("input");var label=curryComponent("label");var li=curryComponent("li");var option=curryComponent("option");var p=curryComponent("p");var select=curryComponent("select");var textarea=curryComponent("textarea");var ul=curryComponent("ul");var stream=stream;var apply=apply;var constant=constant;var curry=curry;var id=id;var add=add;var subtract=subtract;var mathMax=mathMax;var mathMin=mathMin;var measureWidth=measureWidth;var measureHeight=measureHeight;var updateDomFunc=updateDomFunc;var caseSplit=function(t,n){if(!n){return function(n){for(var e in t){if(t.hasOwnProperty(e)&&n.hasOwnProperty(e)){if(!$.isFunction(t[e])){return t[e]}return t[e](n[e])}}}}for(var e in t){if(t.hasOwnProperty(e)&&n.hasOwnProperty(e)){if(!$.isFunction(t[e])){return t[e]}return t[e](n[e])}}};var _scrollbarWidth=function(){var t,n,e;if(e===undefined){t=$('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");n=t.children();e=n.innerWidth()-n.height(99).innerWidth();t.remove()}return e};var unit=function(t){return function(n){return n+t}};var px=unit("px");var vw=unit("vw");var onceZeroS=stream.once(0);var windowWidth=stream.create();var windowHeight=stream.create();var updateWindowWidth=function(){stream.push(windowWidth,window.innerWidth)};var updateWindowHeight=function(){stream.push(windowHeight,window.innerHeight)};$(updateWindowWidth);$(updateWindowHeight);$(window).on("resize",function(){updateWindowWidth();updateWindowHeight()});var windowResize=stream.once(null,true);$(window).on("resize",function(t){stream.push(windowResize,t)});var windowScroll=stream.create(true);$(window).on("scroll",function(){stream.push(windowScroll,window.scrollY)});stream.push(windowScroll,window.scrollY);var windowHash=stream.create(true);$(window).on("hashchange",function(){stream.push(windowHash,location.pathname)});stream.push(windowHash,location.pathname);var displayedS=stream.once(false);var layoutRecurse=function(t,n,e){if($.isArray(e)){return e.map(function(e){return layoutRecurse(t,n,e)})}else{if(!$.isFunction(e)){console.log("cs is not a function");debugger}return function(t){var r=e(t);if(!r||!r.minWidth||!r.minHeight){console.log("not a component");debugger}n.unbuild(r.destroy);r.$el.css("visibility","hidden").css("position","absolute");stream.onValue(t.widthCss||t.width,function(t){updateDomFunc(r.$el,"width",t)});stream.onValue(t.heightCss||t.height,function(t){updateDomFunc(r.$el,"height",t)});stream.onValue(t.topCss||t.top,function(t){updateDomFunc(r.$el,"top",t)});stream.onValue(t.leftCss||t.left,function(t){updateDomFunc(r.$el,"left",t)});stream.combine([t.width,t.height,t.top,t.left],function(){updateDomFunc(r.$el,"visibility","initial")});return r}}};var layout=function(t,n){var e=n?t:div;var r=n||t;return function(){var t=Array.prototype.slice.call(arguments);return e(function(n,e){n.css("pointer-events","none").css("position","relative");return r.apply(null,[n,e].concat(layoutRecurse(n,e,t)))})}};var container=function(t,n){var e=n?t:div;var r=n||t;return div(function(t,n){return r(t,n,function(e){return layoutRecurse(t,n,e)})})};var all=function(t){return function(n){return t.reduce(function(t,n){return n(t)},n)}};var rootLayout=layout(function(t,n,e){stream.combine([n.width,n.height,n.top,n.left],function(){console.log("aoeu");stream.push(displayedS,true)});return e(n.child())});var rootComponent=function(t,n){n=n||{};var e=_scrollbarWidth();var r=stream.create();var i=stream.create();var a=stream.create();stream.combine([windowWidth,windowHeight,a],function(t,n,a){var o=a(t);var u=a(t-e);if(document.body.scrollHeight>window.innerHeight){stream.push(r,t-e);stream.push(i,u);return}if(o>n){if(u>n){$("body").css("overflow-y","initial");stream.push(r,t-e);stream.push(i,u)}else{$("body").css("overflow-y","scroll");stream.push(r,t-e);stream.push(i,u)}}else{$("body").css("overflow-y","initial");stream.push(r,t);stream.push(i,o)}});var o=[];var u=rootLayout(t)({$el:$("body"),width:r,height:i,top:onceZeroS,left:onceZeroS,topAccum:onceZeroS,leftAccum:onceZeroS,unbuild:o.push});u.$el.css("position","absolute").css("top","0px").css("left","0px").css("background-color",n.noBackground?"":"white");var s=u.$el.css("height");stream.map(displayedS,function(t){if(t){setTimeout(function(){$(".server-content").css("display","none");console.log("did it");console.log("golly look at this endearing debug output")},500)}});var c=u.destroy;u.destroy=function(){o.map(apply());c()};stream.pushAll(u.minHeight,a);stream.all([r,i],function(t,n){u.$el.css("width",px(t)).css("height",px(n))});return u};var color=function(t){return{r:t.r||0,g:t.g||0,b:t.b||0,a:t.a||1}};var multiplyColor=function(t){return function(n){return{r:Math.min(255,n.r*t),g:Math.min(255,n.g*t),b:Math.min(255,n.b*t),a:n.a}}};var desaturate=function(t){return function(n){var e=(n.r+n.g+n.b)/3;var r=1-t;return{r:r*n.r+t*e,g:r*n.g+t*e,b:r*n.b+t*e,a:n.a}}};var colorBrightness=function(t){return(t.r+t.g+t.b)/(255+255+255)};var colorString=function(t){return"rgba("+Math.floor(t.r)+","+Math.floor(t.g)+","+Math.floor(t.b)+","+t.a+")"};var rgbColorString=function(t){return"rgb("+Math.floor(t.r)+","+Math.floor(t.g)+","+Math.floor(t.b)+")"};var transparent=color({a:0});var black=color({r:0,g:0,b:0});var white=color({r:255,g:255,b:255});var mapMinWidths=function(t){return stream.combine(t.map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);return t})};var mapMinHeights=function(t){return stream.combine(t.map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);return t})};var url=function(t){return'url("'+t+'")'};var and=function(t){return function(n){return function(e){var r=n(e);t(r,e);return r}}};var $$=function(t){return and(function(n){return t(n.$el)})};var jqueryMethod=function(t){return function(){var n=Array.prototype.slice.call(arguments);return $$(function(e){e[t].apply(e,n)})}};var $addClass=jqueryMethod("addClass");var $attr=jqueryMethod("attr");var $css=jqueryMethod("css");var $on=jqueryMethod("on");var $prop=jqueryMethod("prop");var useMinWidth=function(t,n){return stream.pushAll(n.minWidth,t.width)};var useMinHeight=function(t,n){return stream.combineInto([t.width,n.minHeight],function(t,n){return n(t)},t.height)};var withMinWidth=function(t){return layout(function(n,e,r){n.addClass("withMinWidth");var i=r(e.child());return{minWidth:stream.once(t),minHeight:i.minHeight}})};var withMinHeight=function(t){return layout(function(n,e,r){n.addClass("withMinHeight");var i=r(e.child());return{minWidth:i.minWidth,minHeight:stream.once(constant(t))}})};var withDimensions=function(t,n){return layout(function(e,r,i){e.addClass("withDimensions");var a=i(r.child());return{minWidth:stream.once(t),minHeight:stream.once(constant(n))}})};var passthrough=function(t,n){return layout(n||div,function(n,e,r){n.addClass("passthrough");t&&t(n);return r(e.child())})};var adjustPosition=function(t,n){t=t||{};t.minWidth=t.minWidth||id;t.minHeight=t.minHeight||id;n=n||{};n.top=n.top||onceZeroS;n.left=n.left||onceZeroS;n.width=n.width||id;n.height=n.height||id;return layout(function(e,r,i){var a=r.child({top:true,left:true,width:true,height:true});var o=i(a);stream.pushAll(n.top,a.top);stream.pushAll(n.left,a.left);stream.pushAll(stream.map(r.width,n.width),a.width);stream.pushAll(stream.map(r.height,n.height),a.height);return{minWidth:stream.map(o.minWidth,function(n){return t.minWidth(n)}),minHeight:stream.map(o.minHeight,function(n){return t.minHeight(n)})}})};var adjustMinSize=function(t){return layout(function(n,e,r){var i=r(e.child());return{minWidth:stream.map(i.minWidth,function(n){return t.mw(n)}),minHeight:stream.map(i.minHeight,function(n){return t.mh(n)})}})};var link=all([$css("cursor","pointer"),$css("pointer-events","initial")]);var onThis=function(t){return function(n){return $on(t,n)}};var changeThis=onThis("change");var clickThis=onThis("click");var inputPropertychangeThis=onThis("input propertychange");var keydownThis=onThis("keydown");var keyupThis=onThis("keyup");var mousedownThis=onThis("mousedown");var mousemoveThis=onThis("mousemove");var mouseoverThis=onThis("mouseover");var mouseoutThis=onThis("mouseout");var mouseupThis=onThis("mouseup");var submitThis=onThis("submit");var pushOnClick=function(t,n){return clickThis(function(e){stream.push(t,n(e))})};var hoverThis=function(t){return passthrough(function(n){t(false,n);n.on("mouseover",function(e){t(true,n,e)});n.on("mouseout",function(e){t(false,n,e)})})};var hoverStream=function(t,n){n=n||function(t){return t};return $$(function(e){e.css("pointer-events","initial");e.on("mouseover",function(e){stream.push(t,n(e))});e.on("mouseout",function(e){stream.push(t,n(false))})})};var cssStream=function(t,n){return passthrough(function(e){stream.map(n,function(n){e.css(t,n)})})};var withBackgroundColor=function(t,n){if(!stream.isStream(t)){t=stream.once({backgroundColor:t,fontColor:n})}return $$(function(n){stream.map(t,function(t){var e=t.backgroundColor;var r=t.fontColor;if(e){n.css("background-color",colorString(e))}if(r){n.css("color",colorString(r))}})})};var withFontColor=function(t){return passthrough(function(n){n.css("color",colorString(t))})};var crop=function(t){var n=t.all||0,e=t.all||0,r=t.all||0,i=t.all||0;if($.isNumeric(t)){n=e=r=i=t}else{for(var a in t){var o=a.toLowerCase();if(t[a]!==null){if(o.indexOf("top")!==-1){n=t[a]}if(o.indexOf("bottom")!==-1){e=t[a]}if(o.indexOf("left")!==-1){r=t[a]}if(o.indexOf("right")!==-1){i=t[a]}}}}return layout(function(t,a,o){t.addClass("crop");t.css("overflow","hidden");var u=stream.create();var s=o(a.child({top:stream.prop(u,"top"),left:stream.prop(u,"left"),width:stream.prop(u,"width"),height:stream.prop(u,"height")}));var c=stream.create();var h=stream.create();stream.combineInto([s.minWidth,s.minHeight,a.width,a.height],function(t,a,o,u){var s=o/(1-r-i);var c=u/(1-n-e);return{top:-n*c,left:-r*s,width:s,height:c}},u);stream.combine([s.minWidth,s.minHeight],function(t,a){stream.push(c,t*(1-r-i));stream.push(h,function(o){return a(t/(1-r-i))*(1-n-e)})});return{minWidth:c,minHeight:h}})};var keepAspectRatio=function(t){t=t||{};return layout(function(n,e,r){n.addClass("keepAspectRatio");n.css("overflow","hidden");var i=stream.create();var a=r(e.child({top:stream.prop(i,"top"),left:stream.prop(i,"left"),width:stream.prop(i,"width"),height:stream.prop(i,"height")}));stream.combineInto([a.minWidth,a.minHeight,e.width,e.height],function(n,e,r,i){var a=n/e(n);var o=r/i;if(!t.fill&&o>a||t.fill&&o<a){var u=i*a;var s;if(t.left){s=0}else if(t.right){s=r-u}else{s=(r-u)/2}return{top:0,left:s,width:u,height:i}}else{var c=r/a;var h;if(t.top){h=0}else if(t.bottom){h=i-c}else{h=(i-c)/2}return{top:h,left:0,width:r,height:c}}},i);var o=stream.create();var u=stream.create();stream.combine([a.minWidth,a.minHeight],function(n,e){if(t.minWidth){stream.push(o,t.minWidth)}else if(t.minHeight){stream.push(o,t.minHeight*n/e(n))}else{stream.push(o,n)}stream.push(u,function(t){return t/(n/e(n))})});return{minWidth:o,minHeight:u}})};var image=function(t){var n=stream.isStream(t.src)?t.src:stream.once(t.src);return img(function(e,r){var i=stream.create();var a=stream.create();stream.map(n,function(t){e.prop("src",t)});e.on("load",function(){var n=e[0].naturalWidth/e[0].naturalHeight;var r=t.minWidth||t.minHeight&&t.minHeight*n||e[0].naturalWidth;stream.push(i,r);stream.push(a,function(t){return t/n})});return{minWidth:i,minHeight:a}})};var linkTo=function(t){return layout(a,function(n,e,r){n.prop("href",t);n.css("pointer-events","initial");return r(e.child())})};var empty=function(t){return t(function(t,n){return{minWidth:onceZeroS,minHeight:stream.once(constant(0))}})};var nothing=empty(div);var text=function(t,n){t=t||"";if(!$.isArray(t)){t=[t]}n=n||t[0];if($.isArray(n)){n=n.reduce($.extend,{})}return(n.el||div)(function(e,r){var i=false;var a=stream.create();var o=stream.create();t.map(function(t){if($.type(t)==="string"){t={str:" "+t+" "}}var r=$(document.createElement("span"));r.html(t.str);if(t.size||n.size){r.css("font-size",t.size)}if(t.weight){r.css("font-weight",t.weight)}if(t.family){r.css("font-family",t.family)}if(t.color){r.css("color",colorString(t.color))}if(t.shadow){r.css("text-shadow",t.shadow)}if(t.spanCSS){t.spanCSS.map(function(t){r.css(t.name,t.value)})}if(t.linkTo){var i=$(document.createElement("a"));i.prop("href",t.linkTo).appendTo(e);r.appendTo(i)}else{r.appendTo(e)}});var u=function(){setTimeout(function(){var t=n.minWidth||measureWidth(e);var r=n.oneLine&&e.css("line-height").indexOf("px")!==-1&&constant(parseFloat(e.css("line-height")))||n.minHeight&&constant(n.minHeight)||measureHeight(e);stream.push(a,t);stream.push(o,r)})};if(n.size){if(stream.isStream(n.size)){stream.map(n.size,function(t){e.css("font-size",t);u()})}else{e.css("font-size",n.size)}}if(n.weight){if(stream.isStream(n.weight)){stream.map(n.weight,function(t){e.css("font-weight",t);u()})}else{e.css("font-weight",n.weight)}}if(n.family){if(stream.isStream(n.family)){stream.map(n.family,function(t){e.css("font-family",t);u()})}else{e.css("font-family",n.family)}}if(n.color){if(stream.isStream(n.color)){stream.map(n.color,function(t){e.css("color",colorString(t));u()})}else{e.css("color",colorString(n.color))}}if(n.shadow){if(stream.isStream(n.shadow)){stream.map(n.shadow,function(t){e.css("text-shadow",t);u()})}else{e.css("text-shadow",n.shadow)}}if(n.align){if(stream.isStream(n.align)){stream.map(n.align,function(t){e.css("text-align",t);u()})}else{e.css("text-align",n.align)}}u();return{minWidth:a,minHeight:o}})};var ignoreSurplusWidth=function(t,n){return n};var ignoreSurplusHeight=function(t,n){return n};var centerSurplusWidth=function(t,n){var e=n[n.length-1];var r=t-(e.left+e.width);var i=r/n.length;n.map(function(t,n){t.left+=r/2});return n};var evenSplitSurplusWidth=function(t,n){var e=n[n.length-1];var r=t-(e.left+e.width);var i=r/n.length;n.map(function(t,n){t.width+=i;t.left+=n*i});return n};var centerAllSameSurplusWidth=function(){var t=0;return function(n,e,r,i){if(i===0){e=evenSplitSurplusWidth(n,e);t=e[0].width;return e}else{e.map(function(n,e){n.width=t;n.left=t*e});return centerSurplusWidth(n,e)}}};var evenSplitSurplusWidthWithMinPerRow=function(t){return function(n,e){var r=e[e.length-1];var i=n-(r.left+r.width);var a=n/Math.max(t,e.length);e.map(function(t,n){t.width=a;t.left=n*a});r=e[e.length-1];i=n-(r.left+r.width);a=i/e.length;e.map(function(t,n){t.left+=i/2});return e}};var justifySurplusWidth=function(t,n){var e=n[n.length-1];var r=t-(e.left+e.width);n.map(function(t,e){for(var i=0;i<e;i++){t.left+=r/(n.length-1)}});return n};var justifyAndCenterSurplusWidth=function(t,n){var e=n[n.length-1];var r=t-(e.left+e.width);n.map(function(t,e){t.left+=e*r/n.length+r/(2*n.length)});return n};var surplusWidthAlign=function(t){return function(n,e){var r=e[e.length-1];var i=n-(r.left+r.width);e.map(function(n,e){n.left+=t*i});return e}};var surplusWidthAlignLeft=surplusWidthAlign(0);var surplusWidthAlignCenter=surplusWidthAlign(.5);var surplusWidthAlignRight=surplusWidthAlign(1);var superSurplusWidth=function(t,n){var e=n[n.length-1];var r=t-(e.left+e.width);if(n.length===1){if(r<n[0].width){return evenSplitSurplusWidth(t,n)}else{return n}}if(n.length===2){return justifyAndCenterSurplusWidth(t,n)}return justifySurplusWidth(t,n)};var giveToNth=function(t){return function(n,e){var r=e[e.length-1];var i=n-(r.left+r.width);e.map(function(n,r){if(r===t||r===e.length-1&&t>=e.length){n.width+=i}else if(r>t){n.left+=i}});return e}};var giveToFirst=giveToNth(0);var giveToSecond=giveToNth(1);var giveToThird=giveToNth(2);var centerSurplusHeight=function(t,n){var e=n[n.length-1];var r=t-(e.top+e.height);n.map(function(t,n){t.top+=r/2});return n};var evenSplitSurplusHeight=function(t,n){var e=n[n.length-1];var r=t-(e.top+e.height);var i=r/n.length;n.map(function(t,n){t.height+=i;t.top+=n*i});return n};var giveHeightToNth=function(t){return function(n,e){var r=e[e.length-1];var i=n-(r.top+r.height);e.map(function(n,r){if(r===t||r===e.length-1&&t>=e.length){n.height+=i}else if(r>t){n.top+=i}});return e}};var giveHeightToLast=function(t,n){var e=n.length-1;var r=n[n.length-1];var i=t-(r.top+r.height);n.map(function(t,r){if(r===e||r===n.length-1&&e>=n.length){t.height+=i}else if(r>e){t.top+=i}});return n};var slideshow=function(t,n){t.padding=t.padding||0;t.leftTransition=t.leftTransition||"none";t.alwaysFullWidth=t.alwaysFullWidth||false;return layout(function(n,e,r){n.css("overflow","hidden");n.addClass("slideshow");var i=r.map(function(){return e.child({left:true,width:true})});var a=r.map(function(t,n){return t(i[n])});a.map(function(n){n.$el.css("transition","left "+t.leftTransition)});var o=mapMinWidths(a);var u=mapMinHeights(a);var s=stream.combine([t.selectedS,e.width,o,u],function(n,e,r,a){var o=0;var u=0;var s=0;var c=r.map(function(r,i){r=t.alwaysFullWidth?e:r;if(n===i){o=s+t.padding*i;u=r}var a={left:s+t.padding*i,width:r};s+=r;return a});var h=(e-u)/2-o;c.map(function(t){t.left+=h});c.map(function(t,n){var e=i[n];stream.push(e.left,t.left);stream.push(e.width,t.width)});return constant(a.map(function(t,n){return t(c[n].width)}).reduce(mathMax,0))});stream.push(s,constant(0));return{minWidth:stream.map(o,function(n){return n.reduce(add,t.padding*(a.length-1))}),minHeight:s}})};var sideBySide=function(t){t=t||{};t.padding=t.padding||0;t.handleSurplusWidth=t.handleSurplusWidth||ignoreSurplusWidth;return layout(function(n,e,r){n.addClass("sideBySide");if(r.length===0){return{minWidth:stream.once(0),minHeight:stream.once(constant(0))}}var i=[];var a=r.map(function(t){var n=e.child({left:true,width:true});i.push(n);return t(n)});var o=mapMinWidths(a);var u=mapMinHeights(a);var s=[u];var c=function(n,e){var r=0;var i=e.map(function(e,i){var a=Math.min(n,e);var o={left:r+t.padding*i,width:a};r+=a;return o});i=t.handleSurplusWidth(n,i);return i};stream.all([e.width,o,u,t.sourcePositionsS||stream.once([])],function(n,e,r,a){var o=c(n,e);if(t.targetPositionsS){stream.push(t.targetPositionsS,o)}a.map(function(t,n){o[n]=t});o.map(function(t,n){var e=i[n];stream.push(e.left,t.left);stream.push(e.width,t.width)})});return{minWidth:stream.map(o,function(n){return n.reduce(add,t.padding*(a.length-1))}),minHeight:stream.combine([o,u],function(t,n){return function(e){var r=c(e,t);return r.map(function(t,e){return n[e](r[e].width)}).reduce(mathMax,0)}})}})};var slideIn=function(t){t=t||{};t.top=t.top||50;t.transition=t.transition||"1s";return layout(function(n,e,r){var i=e.child({top:true});var a=r(i);a.$el.css("transition","top "+t.transition);var o=false;stream.push(i.top,t.top);stream.combine([e.topAccum,e.top,windowHeight,windowScroll,displayedS],function(t,n,e,r,a){if(!o&&a){var u=t+n;var s=r+e;if(u<=s){stream.push(i.top,0);o=true}}});return{minWidth:a.minWidth,minHeight:a.minHeight}})};var fadeIn=function(t){t=t||{};t.transition=t.transition||"1s";t.margin=t.margin||0;return layout(function(n,e,r){var i=r(e.child());var a=false;i.$el.css("opacity",0);setTimeout(function(){i.$el.css("transition","opacity "+t.transition)});stream.combine([e.topAccum,e.top,windowHeight,windowScroll,displayedS],function(n,e,r,o,u){if(!a&&u){var s=n+e;var c=o+r;if(s+t.margin<=c){i.$el.css("opacity",1);a=true}}});return{minWidth:i.minWidth,minHeight:i.minHeight}})};var slider=function(t,n){t=t||{};t.leftTransition=t.leftTransition||"0s";var e=stream.once(false);var r={left:"left",right:"right"};var i=stream.once({index:0,edge:"left"});var a=0;return layout(function(n,r,o){n.addClass("slider").css("overflow-x","hidden").css("cursor","move");var u=stream.create();var s=stream.create();var c=stream.combine([r.width,u,i,e],function(t,n,e,r){var i=e.edge==="left"?0:t;n.map(function(t,n){if(n<e.index){i-=t}if(e.edge==="right"&&n===e.index){i-=t}});if(r!==false){i+=r}return i});var h=stream.combine([u,c],function(t,n){return t.reduce(function(t,n){t.arr.push(t.lastValue);t.lastValue+=n;return t},{arr:[],lastValue:n}).arr});var m=o.map(function(t,n){return r.child({top:stream.once(0),left:stream.map(h,function(t){return t[n]}),width:true,height:r.height})});var l=o.map(function(t,n){var e=m[n];var r=t(e);stream.pushAll(r.minWidth,e.width);return r});stream.pushAll(mapMinWidths(l),u);stream.pushAll(mapMinHeights(l),s);var f=stream.map(u,function(t){return t.reduce(add,0)});n.css("user-select","none");n.on("mousedown",function(t){t.preventDefault();stream.push(e,0);l.map(function(t){t.$el.css("transition","left 0s")})});var d=function(n){l.map(function(n){n.$el.css("transition","left "+t.leftTransition)});var a=u.lastValue;var o=r.width.lastValue;var s=e.lastValue;if(!s){return}var h=c.lastValue;var m=a.reduce(function(t,n){var e=t[t.length-1];t.push(e-n);return t},[0]);var f=m.reduce(function(t,n,e){var r=Math.abs(n-h);var i=Math.abs(n-(h-o));return{left:r<t.left.distance?{distance:r,index:e}:t.left,right:i<t.right.distance?{distance:i,index:e-1}:t.right}},{left:{distance:Number.MAX_VALUE,index:-1},right:{distance:Number.MAX_VALUE,index:-1}});if(f.left.distance<=f.right.distance){stream.push(i,{index:f.left.index,edge:"left"})}else{stream.push(i,{index:f.right.index,edge:"right"})}stream.push(e,false);n.preventDefault()};n.on("mouseup",d);n.on("mouseout",d);n.on("mousemove",function(t){var n=e.lastValue;var i=f.lastValue;var o=r.width.lastValue;var u=c.lastValue;if(n!==false){var s=t.clientX-a;var h=u+s;h=Math.min(0,h);if(i>o){h=Math.max(o-i,h)}s=h-u;n=n+s;stream.push(e,n)}a=t.clientX});return{minWidth:stream.map(u,function(t){return t.reduce(mathMax,0)}),minHeight:stream.combine([u,s],function(t,n){return constant(n.map(function(n,e){return n(t[e])}).reduce(mathMax,0))})}})};var stack=function(t){t=t||{};t.padding=t.padding||0;t.handleSurplusHeight=t.handleSurplusHeight||ignoreSurplusHeight;return layout(function(n,e,r){n.addClass("stack");if(r.length===0){return{minWidth:stream.once(0),minHeight:stream.once(constant(0))}}var i=[];var a=r.map(function(t){var n=e.child({widthCss:stream.once("100%"),top:true,height:true});i.push(n);return t(n)});if(t.transition){var o=t.transition+"s";a.map(function(t){t.$el.css("transition","height "+o+", top "+o)})}var u=mapMinWidths(a);var s=mapMinHeights(a);stream.all([e.width,e.height,s],function(n,e,r){var a=0;var o=r.map(function(e,r){var i={top:a+t.padding*r,height:e(n)};a+=e(n);return i});o=t.handleSurplusHeight(e,o);o.map(function(t,n){var e=i[n];stream.push(e.top,t.top);stream.push(e.height,t.height)})});return{minWidth:stream.map(u,function(t){return t.reduce(mathMax,0)}),minHeight:stream.map(s,function(n){return function(e){return n.map(apply(e)).reduce(add,t.padding*(a.length-1))}})}})};var stackStream=function(t){t=t||{};t.padding=t.padding||0;t.handleSurplusHeight=t.handleSurplusHeight||ignoreSurplusHeight;t.transition=t.transition||0;return function(n){return container(function(e,r,i){var a=stream.once(0);var o=stream.once(constant(0));var u=[];var s=[];var c=[];var h=[];var m=function(){var n=r.width.lastValue;var e=r.height.lastValue;var i=[];var c=[];s.map(function(t,n){i[n]=t.minWidth.lastValue;c[n]=t.minHeight.lastValue});if(!i.concat(c).reduce(function(t,n){return t&&n!==undefined},true)){return}stream.push(a,i.reduce(mathMax,0));stream.push(o,function(n){return c.map(apply(n)).reduce(add,t.padding*(s.length-1))});if(n===undefined){return}if(e===undefined){return}var h=0;var m=-1;var l=c.map(function(e){m+=1;var r={top:h+t.padding*m,height:e(n)};h+=e(n);return r});l=t.handleSurplusHeight(e,l);u.map(function(t,n){var e=l[n];stream.push(t.top,e.top);stream.push(t.height,e.height)})};stream.onValue(r.width,m);stream.onValue(r.height,m);var l=[];var f=-1;var d=function(t,n){for(var e=l.length;e>n;e--){l[e+1]=l[e];c[e+1]=c[e];h[e+1]=h[e];u[e+1]=u[e];s[e+1]=s[e]}f+=1;var a=r.child({top:true,height:true});var o=i(t)(a);l[f]=t;c[f]=stream.onValue(o.minWidth,m);h[f]=stream.onValue(o.minHeight,m);u[f]=a;s[f]=o;return f};var p=function(t){var n=l.indexOf(t);s[n].destroy();c[n]();h[n]();delete l[n];delete c[n];delete h[n];delete u[n];delete s[n];m()};stream.onValue(n,function(t){caseSplit({insert:d,insertMany:function(t){t.map(d)},remove:p},t)});return{minWidth:a,minHeight:o}})}};var tree=function(t,n){t=t||{};t.indent=t.indent||10;return function(n){var e=stream.once(true);return sideBySide()([componentStream(stream.map(e,function(t){})),stackStream(t)(stream.map(n,caseSplit({expand:function(t,n){},collapse:function(t){}})))])}};var intersperse=function(t,n){var e=[];t.map(function(t){e.push(t);e.push(n)});e.pop();return e};var margin=function(t){var n=t.all||0,e=t.all||0,r=t.all||0,i=t.all||0;if($.isNumeric(t)){n=e=r=i=t}else{for(var a in t){var o=a.toLowerCase();if(t[a]!==null){if(o.indexOf("top")!==-1){n=t[a]||0}if(o.indexOf("bottom")!==-1){e=t[a]||0}if(o.indexOf("left")!==-1){r=t[a]||0}if(o.indexOf("right")!==-1){i=t[a]||0}}}}return layout(function(t,a,o){t.addClass("margin");var u=o(a.child({top:stream.once(n),left:stream.once(r),width:stream.map(a.width,function(t){return t-r-i}),height:stream.map(a.height,function(t){return t-n-e}),widthCss:stream.once("calc(100% - "+px(r+i)+")"),heightCss:stream.once("calc(100% - "+px(n+e)+")")}));return{minWidth:stream.map(u.minWidth,function(t){return t+r+i}),minHeight:stream.map(u.minHeight,function(t){return function(a){return t(a-r-i)+n+e}})}})};var expandoStream=function(t){var n=stream.create();var e=stream.create();var r=stream.create();var i=stream.create();stream.map(t,function(t){var a=t.all||0,o=t.all||0,u=t.all||0,s=t.all||0;if($.isNumeric(t)){a=o=u=s=t}else{for(var c in t){var h=c.toLowerCase();if(t[c]!==null){if(h.indexOf("top")!==-1){a=t[c]}if(h.indexOf("bottom")!==-1){o=t[c]}if(h.indexOf("left")!==-1){u=t[c]}if(h.indexOf("right")!==-1){s=t[c]}}}}stream.push(n,a);stream.push(e,o);
stream.push(r,u);stream.push(i,s)});return layout(function(t,a,o){var u=o(a.child({top:n,left:r,height:stream.combine([a.height,n,e],function(t,n,e){return t-n-e}),width:stream.combine([a.width,r,i],function(t,n,e){return t-n-e})}));return{minWidth:stream.combine([u.minWidth,r,i],function(t,n,e){return t+n+e}),minHeight:stream.combine([u.minHeight,n,e],function(t,n,e){return function(r){return t(r)+n+e}})}})};var alignLRM=function(t){t=t||{};t.transition=(t.transition||0)+"s";return function(t){return layout(function(t,n,e,r,i){t.addClass("alignLRM");var a=n.child({width:true});var o=n.child({width:true,left:true});var u=n.child({width:true,left:true});var s=e(a);var c=r(o);var h=i(u);stream.combine([s.minWidth,c.minWidth,h.minWidth,n.width],function(t,n,e,r){stream.push(a.width,Math.min(r,t));stream.push(o.width,Math.min(r,n));stream.push(u.width,Math.min(r,e));stream.push(a.left,0);stream.push(o.left,r-Math.min(r,n));stream.push(u.left,(r-Math.min(r,e))/2)});return{minWidth:stream.combine([s.minWidth,c.minWidth,h.minWidth],function(t,n,e){return[t,n,e].reduce(add)}),minHeight:stream.combine([s.minWidth,c.minWidth,h.minWidth,s.minHeight,c.minHeight,h.minHeight],function(t,n,e,r,i,a){return function(o){return[r(Math.min(o,t)),i(Math.min(o,n)),a(Math.min(o,e))].reduce(mathMax)}})}})(t.l||nothing,t.r||nothing,t.m||nothing)}};var alignLeft=function(t){return alignLRM()({l:t})};var alignRight=function(t){return alignLRM()({r:t})};var center=function(t){return function(n){return alignLRM(t)({m:n})}};var alignTBM=function(t){t=t||{};t.transition=(t.transition||0)+"s";return function(n){return layout(function(n,e,r,i,a){n.addClass("alignTBM");var o=e.child({height:true});var u=e.child({height:true,top:true});var s=e.child({height:true,top:true});var c=r(o);var h=i(u);var m=a(s);stream.combine([c.minHeight,h.minHeight,m.minHeight,e.width,e.height],function(t,n,e,r,i){stream.push(o.height,Math.min(i,t(r)));stream.push(u.height,Math.min(i,n(r)));stream.push(s.height,Math.min(i,e(r)));stream.push(o.top,0);stream.push(u.top,Math.max(0,i-Math.min(i,n(r))));stream.push(s.top,Math.max(0,(i-Math.min(i,e(r)))/2))});c.$el.css("transition","top "+t.transition);h.$el.css("transition","top "+t.transition);m.$el.css("transition","top "+t.transition);return{minWidth:stream.combine([c.minWidth,h.minWidth,m.minWidth],function(t,n,e){return[t,n,e].reduce(mathMax)}),minHeight:stream.combine([c.minHeight,h.minHeight,m.minHeight],function(t,n,e){return function(r){return[t,n,e].map(apply(r)).reduce(add)}})}})(n.t||nothing,n.b||nothing,n.m||nothing)}};var alignTop=function(t){return alignTBM()({t:t})};var alignBottom=function(t){return alignTBM()({b:t})};var alignMiddleVertical=function(t){return alignTBM()({m:t})};var alignAbsoluteCenter=function(t){return alignTBM()({m:alignLRM()({m:t})})};var border=function(t,n,e){var r=n.left||n.all||0;var i=n.right||n.all||0;var a=n.top||n.all||0;var o=n.bottom||n.all||0;var u=n.radius||0;if($.isNumeric(n)){a=o=r=i=n}e=e||"solid";if(!stream.isStream(t)){t=stream.once(t)}var s=stream.map(t,colorString);return layout(function(t,n,c){t.addClass("border");var h=c(n.child({width:stream.map(n.width,function(t){return t-r-i}),height:stream.map(n.height,function(t){return t-a-o}),widthCss:stream.once("calc(100% - "+px(r+i)+")"),heightCss:stream.once("calc(100% - "+px(a+o)+")")}));h.$el.css("overflow","hidden");h.$el.css("border-radius",px(u));stream.map(s,function(t){h.$el.css("border-left",px(r)+" "+e+" "+t).css("border-right",px(i)+" "+e+" "+t).css("border-top",px(a)+" "+e+" "+t).css("border-bottom",px(o)+" "+e+" "+t)});return{minWidth:stream.map(h.minWidth,function(t){return t+r+i}),minHeight:stream.map(h.minHeight,function(t){return function(n){return t(n)+a+o}})}})};var componentStream=function(t){var n=new Error;return container(function(n,e,r){n.addClass("componentStream");var i;var a;var o;e.unbuild(function(){if(i){i.destroy()}});var u=stream.create();var s=stream.create();var c=stream.reduce(t,function(t,n){if(t){t.destroy()}if(a){a()}if(o){o()}t=r(n)(e.child({widthCss:stream.once("100%"),heightCss:stream.once("100%")}));a=stream.pushAll(t.minWidth,u);o=stream.pushAll(t.minHeight,s);return t});return{minWidth:u,minHeight:s}})};var componentStreamWithExit=function(t,n){var e;return container(function(r,i,a){r.addClass("component-stream-with-exit");var o=stream.create();stream.pushAll(t,o);var u=stream.create();var s=stream.create();var c=function(t){if(e){(function(t){setTimeout(function(){n(t).then(function(){t.destroy()})})})(e)}e=a(t)(i.child({widthCss:stream.once("100%"),heightCss:stream.once("100%")}));e.$el.css("transition","inherit");stream.pushAll(e.minWidth,u);stream.pushAll(e.minHeight,s)};stream.map(o,function(t){c(t)});i.unbuild(function(){stream.end(o);if(e){e.destroy()}});return{minWidth:u,minHeight:s}})};var promiseComponent=function(t){var n=stream.create();Q(t).then(function(t){stream.push(n,t)},function(t){console.log(t)}).catch(function(t){console.log(t)});return componentStream(n)};var toggleComponent=function(t,n){return componentStream(stream.map(n,function(n){return t[n]}))};var modalDialog=function(t){return function(n,e){var r=stream.once(false);stream.pushAll(n,r);e=e||0;return layout(function(t,n,i){t.addClass("modalDialog");var a=i(n.child({top:stream.once(0),left:stream.once(0),width:stream.map(windowWidth,function(t){return document.body.clientWidth}),height:windowHeight}));t=a.$el;t.css("z-index",100);t.appendTo($("body"));t.css("position","fixed");t.css("transition",t.css("transition")+", opacity "+e+"s");t.css("display","none");t.css("pointer-events","initial");stream.onValue(r,function(n){console.log(n);if(n){t.css("display","");setTimeout(function(){t.css("opacity",1)},100)}else{t.css("opacity",0);setTimeout(function(){t.css("display","none")},e*1e3)}});return{minWidth:onceZeroS,minHeight:stream.once(constant(0))}})(t)}};var toggleHeight=function(t){return layout(function(n,e,r){n.css("overflow","hidden").addClass("toggle-height");var i=e.child();var a=r(i);return{minWidth:a.minWidth,minHeight:stream.combine([a.minHeight,t],function(t,n){return function(e){return n?t(e):0}})}})};var dropdownPanel=function(t,n,e,r){r=r||{};r.transition=r.transition||"0.5s";return layout(function(t,n,e,r){t.addClass("dropdown-panel");var i=n.child({height:true,top:true});var a=n.child();var o=r(i);var u=e(a);useMinHeight(i,o);stream.pushAll(a.height,i.top);return{minWidth:stream.map(stream.combine([o.minWidth,u.minWidth],Math.max),function(t){return t}),minHeight:u.minHeight}})(t,layout(function(t,n,i){var a=n.child({top:stream.combine([e,n.height],function(t,n){return t?0:-n})});if(r.panelHeightS){stream.pushAll(a.height,r.panelHeightS)}var o=i(a);t.css("overflow","hidden");o.$el.css("transition","top "+r.transition).css("z-index",1e3);return o})(n))};var sideSlidingPanel=function(t,n,e,r){r=r||{};r.transition=r.transition||"0.5s";return layout(function(t,n,e,r){t.addClass("dropdown-panel");var i=n.child({width:true,height:true,left:true,top:true});var a=n.child();var o=r(i);var u=e(a);useMinWidth(i,o);stream.combineInto([a.height,windowHeight],function(t,n){return n-t},i.height);stream.pushAll(a.height,i.top);stream.combineInto([a.width,o.minWidth],function(t,n){return t-n},i.left);return{minWidth:stream.map(stream.combine([o.minWidth,u.minWidth],Math.max),function(t){return t}),minHeight:u.minHeight}})(t,layout(function(t,n,i){var a=i(n.child({left:stream.combine([e,n.width],function(t,n){return t?0:n})}));t.css("overflow","hidden");a.$el.css("transition","left "+r.transition).css("z-index",1e3);return a})(n))};var fixedHeaderBody=function(t){t.transition=t.transition||"0.5s";return layout(function(n,e,r,i){var a=stream.create();var o=i({width:e.width,height:a});stream.pushAll(stream.combine([e.width,o.minHeight],function(t,n){return n(t)}),a);var u=stream.create();var s=r({top:a,width:e.width,height:u});stream.pushAll(stream.combine([e.width,s.minHeight],function(t,n){return n(t)}),u);o.$el.css("position","fixed");setTimeout(function(){o.$el.css("transition","height "+t.transition);s.$el.css("transition","top "+t.transition)});return{minWidth:stream.map(stream.combine([s,o].map(function(t){return t.minWidth})),function(t,n){return t+n}),minHeight:stream.map(stream.combine([s,o].map(function(t){return t.minHeight})),function(t,n){return function(e){return t(e)+n(e)}})}})};var makeSticky=function(t){t=t||onceZeroS;return layout(function(n,e,r){n.addClass("makeSticky");var i=e.child({widthCss:stream.once("100%"),heightCss:stream.once("100%")});var a=r(i);stream.all([windowScroll,t,e.top,e.topAccum,e.left,e.leftAccum],function(t,e,r,i,a,o){if(r+i>t+e){n.css("position","absolute");n.css("transition","");n.css("left",px(a))}else if(r+i<t+e){var u=a+o;n.css("position","fixed");n.css("left",px(u));n.css("top",px(e));setTimeout(function(){n.css("transition","inherit")},20)}});return a})};var useNthMinHeight=function(t){return function(n,e){var r=Math.min(t,n.length-1);return e[r](n[r].width)}};var useMaxHeight=function(t,n){return t.reduce(function(t,e,r){return Math.max(t,n[r](e.width))},0)};var grid=function(t){t=t||{};t.padding=t.padding||0;t.handleSurplusWidth=t.handleSurplusWidth||ignoreSurplusWidth;t.handleSurplusHeight=t.handleSurplusHeight||ignoreSurplusHeight;t.rowHeight=t.rowHeight||useMaxHeight;t.maxPerRow=t.maxPerRow||0;t.rowOrColumn=t.rowOrColumn||false;return function(n){return layout(function(n,e,r){n.addClass("grid");var i=stream.create();var a=stream.create();if(r.length===0){stream.push(i,0);stream.push(a,constant(0))}var o=[];var u=r.map(function(t){var n=e.child({top:true,left:true,width:true,height:true});o.push(n);return t(n)});var s=stream.combine(u.map(function(t){return t.minWidth}),function(){return Array.prototype.slice.call(arguments)});var c=stream.combine(u.map(function(t){return t.minHeight}),function(){return Array.prototype.slice.call(arguments)});var h=function(n,e){if(t.allSameWidth){var r=e.reduce(mathMax,0);for(var i=0;i<e.length;i++){e[i]=r}}var a;var u=function(){a=0;return{cells:[],contexts:[],height:0}};var s=e.reduce(function(e,r,i){var s=e.rows;var c=e.currentRow;var h=c.cells.reduce(function(n,e){return n+e.width+t.padding},0);var m=Math.min(r,n);if(t.maxPerRow>0&&c.cells.length===t.maxPerRow||m>0&&m+h>n){s.push(c);c=u()}c.cells.push({width:m,left:a});c.contexts.push(o[i]);a+=m+t.padding;return{rows:s,currentRow:c}},{rows:[],currentRow:u()});var c=s.rows;c.push(s.currentRow);if(t.rowOrColumn&&s.rows.length>1){c=e.map(function(t,n){return{cells:[{width:t,left:0}],contexts:[o[n]],height:0}})}c.map(function(e,r){e.cells=t.handleSurplusWidth(n,e.cells,t,r)});return c};stream.pushAll(stream.map(s,function(n){return n.reduce(function(n,e){return t.useFullWidth?n+e+t.padding:Math.max(n,e)+t.padding},-t.padding)}),i);stream.combineInto([s,c],function(n,e){return function(r){var i=h(r,n);var a=0;var o=i.map(function(n){var r=t.rowHeight(n.cells,e.slice(a,a+n.cells.length));a+=n.cells.length;return r+t.padding}).reduce(add,-t.padding);return o}},a);stream.all([e.width,e.height,s,c],function(n,e,r,i){var a=h(n,r);var o=0;a.map(function(n){n.height=t.rowHeight(n.cells,i.slice(o,o+n.cells.length));o+=n.cells.length});if(t.bottomToTop){a=a.slice(0).reverse()}var u=0;a=t.handleSurplusHeight(e,a,t);a.map(function(n,e){var r=n.cells.map(function(t){var e={top:u,left:t.left,width:t.width,height:n.height};return e});r.map(function(t,e){var r=n.contexts[e];stream.push(r.top,t.top);stream.push(r.left,t.left);stream.push(r.width,t.width);stream.push(r.height,t.height)});u+=n.height+t.padding})});return{minWidth:i,minHeight:a}})(n)}};var withMinWidthStream=function(t){return layout(function(n,e,r){n.addClass("withMinWidthStream");var i=e.child();var a=r(i);return{minWidth:$.isFunction(t)?t(a,i):t,minHeight:a.minHeight}})};var minWidthAtLeast=function(t){if(!stream.isStream(t)){t=stream.once(t)}return withMinWidthStream(function(n){return stream.combine([n.minWidth,t],mathMax)})};var withMinHeightStream=function(t){return layout(function(n,e,r){n.addClass("withMinHeightStream");var i=e.child();var a=r(i);return{minWidth:a.minWidth,minHeight:$.isFunction(t)?t(a,i):t}})};var minHeightAtLeast=function(t){if(!stream.isStream(t)){t=stream.once(t)}return withMinHeightStream(function(n){return stream.combine([n.minHeight,t],function(t,n){return function(e){return Math.max(t(e),n)}})})};var overlays=function(t){return layout(function(t,n,e){t.addClass("overlays");var r=e.map(function(t){return t(n.child())});var i=function(t){return stream.combine(t,function(){var t=Array.prototype.slice.call(arguments);return t.reduce(mathMax,0)})};return{minWidth:stream.combine(r.map(function(t){return t.minWidth}),function(){var t=Array.prototype.slice.call(arguments);return t.reduce(mathMax,0)}),minHeight:stream.combine(r.map(function(t){return t.minHeight}),function(){var t=Array.prototype.slice.call(arguments);return function(n){return t.map(apply(n)).reduce(mathMax,0)}})}})};var tabs=function(t,n){n=n||stream.once(0);return stack({})([sideBySide({handleSurplusWidth:centerSurplusWidth})(t.map(function(t,e){return alignTBM()({b:all([link,clickThis(function(){stream.push(n,e)})])(t.tab(n,e))})})),componentStream(stream.map(n,function(n){return t[n].content}))])};var matchStrings=function(t){return function(n){for(var e=0;e<t.length;e++){var r=t[e];if(n.indexOf(r.string)===0){return r.router(n.substring(r.string.length))}}}};var routeToComponent=function(t){return function(){return t}};var routeToComponentF=function(t){return function(){return t()}};var routeToFirst=function(t){return function(n){for(var e=0;e<t.length;e++){var r=t[e](n);if(r){return r}}}};var routeMatchRest=function(t){return function(n){return promiseComponent(Q(n).then(t))}};var route=function(t,n){return componentStream(stream.map(t,function(t){return n(t)}))};